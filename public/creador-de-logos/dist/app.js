(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.r=function(exports){Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=0)})([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var app=__webpack_require__(31);var cuenta_controller=__webpack_require__(30);var descargar_controller=__webpack_require__(29);var editor_controller=__webpack_require__(28);var header=__webpack_require__(27);var inicio_controller=__webpack_require__(26);var login_controller=__webpack_require__(25);var logos_controller=__webpack_require__(24);var logosGaleria_controller=__webpack_require__(23);var pago_controller=__webpack_require__(22);var pagoCompleto_controller=__webpack_require__(21);var papeleria_controller=__webpack_require__(20);var papeleriaEditor_controller=__webpack_require__(19);var bazamAyuda=__webpack_require__(18);var bazamCarouseles=__webpack_require__(17);var bazamColorPicker=__webpack_require__(16);var bazamFormLogin=__webpack_require__(15);var bazamMail=__webpack_require__(14);var bazamPalettePicker=__webpack_require__(13);var bazamRedireccionar=__webpack_require__(12);var bazamScroll=__webpack_require__(11);var bazamSvg=__webpack_require__(10);var bazamSvgText=__webpack_require__(9);var bazamVisualizar=__webpack_require__(8);var jquery_ui=__webpack_require__(7);var planes=__webpack_require__(6);var stripePaymentForm=__webpack_require__(5);var bazamCrearPapeleria=__webpack_require__(4);var bazamMenuPapeleria=__webpack_require__(3);var bazamPapeleria=__webpack_require__(2);var services=__webpack_require__(1)},function(module,exports){angular.module("disenador-de-logos").value("coloresValue",[["#FFF9D6","#FFED7E","#7F721C"],["#FBFFD3","#F3FF7B","#767F1B"],["#FFE7A4","#FFD458","#7F6A2F"],["#FFDAB8","#FFB26C","#7F4917"],["#FFD6C6","#FF9F7A","#7F3A1E"],["#FFCDC9","#FF857C","#7F2620"],["#FF9193","#FF393D","#7F0A0C"],["#FFC1E9","#FF75CE","#7F1C5C"],["#FFBDFA","#FF71F5","#7F1A78"],["#F0BBFF","#DF6FFF","#69197F"],["#D9C3FF","#A977FF","#411D7F"],["#CFCAFF","#897EFF","#29207F"],["#D3D8FF","#8794FF","#252F7F"],["#D8E3FF","#8BACFF","#17357F"],["#C9E0FF","#7CB4FF","#103F7F"],["#D1F3FF","#84DFFF","#13637F"],["#CDFFEC","#80FFCF","#407F67"],["#DBFFCD","#A5FF80","#547F43 "]]).factory("coloresFactory",[function(){return function(coloresArrays){var i=Math.floor(Math.random()*coloresArrays.length)+0;return coloresArrays[i]}}]).value("coloresPaletaValue",["#f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B","#ffcdd2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#FFFFFF","#CFD8DC","#ef9a9a","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5","#e57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE","#ef5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C","#f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B","#e53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A","#d32f2f","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64","#c62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F","#b71c1c","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"]).value("paisesValue",{BD:"Bangladesh",BE:"Belgium",BF:"Burkina Faso",BG:"Bulgaria",BA:"Bosnia and Herzegovina",BB:"Barbados",WF:"Wallis and Futuna",BL:"Saint Barthelemy",BM:"Bermuda",BN:"Brunei",BO:"Bolivia",BH:"Bahrain",BI:"Burundi",BJ:"Benin",BT:"Bhutan",JM:"Jamaica",BV:"Bouvet Island",BW:"Botswana",WS:"Samoa",BQ:"Bonaire, Saint Eustatius and Saba ",BR:"Brazil",BS:"Bahamas",JE:"Jersey",BY:"Belarus",BZ:"Belize",RU:"Russia",RW:"Rwanda",RS:"Serbia",TL:"East Timor",RE:"Reunion",TM:"Turkmenistan",TJ:"Tajikistan",RO:"Romania",TK:"Tokelau",GW:"Guinea-Bissau",GU:"Guam",GT:"Guatemala",GS:"South Georgia and the South Sandwich Islands",GR:"Greece",GQ:"Equatorial Guinea",GP:"Guadeloupe",JP:"Japan",GY:"Guyana",GG:"Guernsey",GF:"French Guiana",GE:"Georgia",GD:"Grenada",GB:"United Kingdom",GA:"Gabon",SV:"El Salvador",GN:"Guinea",GM:"Gambia",GL:"Greenland",GI:"Gibraltar",GH:"Ghana",OM:"Oman",TN:"Tunisia",JO:"Jordan",HR:"Croatia",HT:"Haiti",HU:"Hungary",HK:"Hong Kong",HN:"Honduras",HM:"Heard Island and McDonald Islands",VE:"Venezuela",PR:"Puerto Rico",PS:"Palestinian Territory",PW:"Palau",PT:"Portugal",SJ:"Svalbard and Jan Mayen",PY:"Paraguay",IQ:"Iraq",PA:"Panama",PF:"French Polynesia",PG:"Papua New Guinea",PE:"Peru",PK:"Pakistan",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PM:"Saint Pierre and Miquelon",ZM:"Zambia",EH:"Western Sahara",EE:"Estonia",EG:"Egypt",ZA:"South Africa",EC:"Ecuador",IT:"Italy",VN:"Vietnam",SB:"Solomon Islands",ET:"Ethiopia",SO:"Somalia",ZW:"Zimbabwe",SA:"Saudi Arabia",ES:"Spain",ER:"Eritrea",ME:"Montenegro",MD:"Moldova",MG:"Madagascar",MF:"Saint Martin",MA:"Morocco",MC:"Monaco",UZ:"Uzbekistan",MM:"Myanmar",ML:"Mali",MO:"Macao",MN:"Mongolia",MH:"Marshall Islands",MK:"Macedonia",MU:"Mauritius",MT:"Malta",MW:"Malawi",MV:"Maldives",MQ:"Martinique",MP:"Northern Mariana Islands",MS:"Montserrat",MR:"Mauritania",IM:"Isle of Man",UG:"Uganda",TZ:"Tanzania",MY:"Malaysia",MX:"Mexico",IL:"Israel",FR:"France",IO:"British Indian Ocean Territory",SH:"Saint Helena",FI:"Finland",FJ:"Fiji",FK:"Falkland Islands",FM:"Micronesia",FO:"Faroe Islands",NI:"Nicaragua",NL:"Netherlands",NO:"Norway",NA:"Namibia",VU:"Vanuatu",NC:"New Caledonia",NE:"Niger",NF:"Norfolk Island",NG:"Nigeria",NZ:"New Zealand",NP:"Nepal",NR:"Nauru",NU:"Niue",CK:"Cook Islands",XK:"Kosovo",CI:"Ivory Coast",CH:"Switzerland",CO:"Colombia",CN:"China",CM:"Cameroon",CL:"Chile",CC:"Cocos Islands",CA:"Canada",CG:"Republic of the Congo",CF:"Central African Republic",CD:"Democratic Republic of the Congo",CZ:"Czech Republic",CY:"Cyprus",CX:"Christmas Island",CR:"Costa Rica",CW:"Curacao",CV:"Cape Verde",CU:"Cuba",SZ:"Swaziland",SY:"Syria",SX:"Sint Maarten",KG:"Kyrgyzstan",KE:"Kenya",SS:"South Sudan",SR:"Suriname",KI:"Kiribati",KH:"Cambodia",KN:"Saint Kitts and Nevis",KM:"Comoros",ST:"Sao Tome and Principe",SK:"Slovakia",KR:"South Korea",SI:"Slovenia",KP:"North Korea",KW:"Kuwait",SN:"Senegal",SM:"San Marino",SL:"Sierra Leone",SC:"Seychelles",KZ:"Kazakhstan",KY:"Cayman Islands",SG:"Singapore",SE:"Sweden",SD:"Sudan",DO:"Dominican Republic",DM:"Dominica",DJ:"Djibouti",DK:"Denmark",VG:"British Virgin Islands",DE:"Germany",YE:"Yemen",DZ:"Algeria",US:"United States",UY:"Uruguay",YT:"Mayotte",UM:"United States Minor Outlying Islands",LB:"Lebanon",LC:"Saint Lucia",LA:"Laos",TV:"Tuvalu",TW:"Taiwan",TT:"Trinidad and Tobago",TR:"Turkey",LK:"Sri Lanka",LI:"Liechtenstein",LV:"Latvia",TO:"Tonga",LT:"Lithuania",LU:"Luxembourg",LR:"Liberia",LS:"Lesotho",TH:"Thailand",TF:"French Southern Territories",TG:"Togo",TD:"Chad",TC:"Turks and Caicos Islands",LY:"Libya",VA:"Vatican",VC:"Saint Vincent and the Grenadines",AE:"United Arab Emirates",AD:"Andorra",AG:"Antigua and Barbuda",AF:"Afghanistan",AI:"Anguilla",VI:"U.S. Virgin Islands",IS:"Iceland",IR:"Iran",AM:"Armenia",AL:"Albania",AO:"Angola",AQ:"Antarctica",AS:"American Samoa",AR:"Argentina",AU:"Australia",AT:"Austria",AW:"Aruba",IN:"India",AX:"Aland Islands",AZ:"Azerbaijan",IE:"Ireland",ID:"Indonesia",UA:"Ukraine",QA:"Qatar",MZ:"Mozambique"}).value("coloresPaletteValue",[[["#009aa6","#e6e6e6","#000000","#ffed00","#aafc00"],["#008b00","#e6e6e6","#000000","#ffed00","#aafc00"],["#74cb00","#ffffff","#000000","#ffed00","#a67848"],["#ffc700","#ffffff","#000000","#0071bc","#c20000"],["#ff4200","#ffffff","#e6e6e6","#000000","#0071bc"],["#740000","#ffffff","#e6e6e6","#00e0cd","#ffde00"],["#890054","#ffffff","#e6e6e6","#00dbff","#aafc00"],["#8400a5","#ffffff","#e6e6e6","#ffed00","#aafc00"],["#4500d4","#ffffff","#e6e6e6","#00dbff","#aafc00"],["#0042ff","#ffffff","#e6e6e6","#00dbff","#aafc00"]],[["#00bfc2","#ffffff","#000000","#ffed00","#a67848"],["#00cc51","#ffffff","#000000","#ffed00","#a67848"],["#83de00","#ffffff","#000000","#ffed00","#a67848"],["#ffde00","#ffffff","#000000","#0071bc","#c20000"],["#ff5000","#ffffff","#e6e6e6","#000000","#0071bc"],["#9f0000","#ffffff","#e6e6e6","#00e0cd","#ffde00"],["#b80060","#ffffff","#e6e6e6","#00dbff","#aafc00"],["#a700b8","#ffffff","#e6e6e6","#ffed00","#aafc00"],["#6129ff","#ffffff","#e6e6e6","#00dbff","#aafc00"],["#0072ff","#ffffff","#e6e6e6","#00dbff","#aafc00"]],[["#00d6c2","#ffffff","#000000","#666666","#a67848"],["#00db75","#ffffff","#000000","#666666","#a67848"],["#8bf300","#ffffff","#000000","#666666","#a67848"],["#ffed00","#000000","#666666","#0071bc","#7a00000"],["#ff7b00","#ffffff","#000000","#ffed00","#00d6c2"],["#c20000","#ffffff","#cccccc","#00e0cd","#ffde00"],["#db006b","#ffffff","#e6e6e6","#00dbff","#aafc00"],["#e700db","#ffffff","#000000","#00dbff","#ffde00"],["#9256ff","#ffffff","#000000","#e6e6e6","#aafc00"],["#009fff","#ffffff","#e6e6e6","#aafc00","#ffed00"]],[["#00f4de","#ffffff","#000000","#666666","#a67848"],["#00ec93","#ffffff","#000000","#666666","#a67848"],["#b3fc00","#ffffff","#000000","#666666","#a67848"],["#e5ff00","#000000","#666666","#0071bc","#7a00000"],["#ff9700","#ffffff","#000000","#ffed00","#00d6c2"],["#e00000","#ffffff","#cccccc","#00e0cd","#ffde00"],["#fd0081","#ffffff","#e6e6e6","#00dbff","#aafc00"],["#ff00ea","#ffffff","#000000","#00dbff","#ffde00"],["#ae77ff","#ffffff","#000000","#e6e6e6","#b3fc00"],["#00dbff","#ffffff","#000000","#666666","#4500d4"]]]).service("etiquetasService",["$http","$q",function($http,$q){this.listarLogos=function(datos){var defered=$q.defer();var promise=defered.promise;$http.post("/app/elementos/categoria",datos).then(function(res){if(res==undefined){return defered.reject(res)}defered.resolve(res)}).catch(function(res){defered.reject(res)});return promise};this.listarEtiquetas=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/etiquetas").then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res.data.msg)});return promise};this.loadEtiquetas=function(arr){var etiquetas=[];angular.forEach(arr,function(valor){etiquetas.push({_id:valor._id,traduccion:valor.traducciones[0]})});return etiquetas.map(function(et){et.traduccion._lowername=et.traduccion.valor.toLowerCase();return et})};this.transformChip=function(chip){if(angular.isObject(chip)){return chip}return{traduccion:{valor:chip}}};this.querySearch=function(query,etiquetas){var results=query?etiquetas.filter(createFilterFor(query)):[];return results};function createFilterFor(query){var lowercaseQuery=angular.lowercase(query);return function filterFn(etiqueta){return etiqueta.traduccion._lowername.indexOf(lowercaseQuery)===0}}}]).service("categoriasService",["$http","$q",function($http,$q){this.listaCategorias=function(tipo){var defered=$q.defer();var promise=defered.promise;$http.post("/app/categorias",{tipo:tipo}).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.listaCategoriasElementos=function(idCategoria,tipo){var defered=$q.defer();var promise=defered.promise;$http.post("/app/elementos/categorias",{idCategoria:idCategoria,tipo:tipo}).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise}}]).service("preferenciasService",["$http","$q",function($http,$q){this.listaPreferencias=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/preferencias").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise}}]).service("elementosService",["$http","$q",function($http,$q){this.listaFuentesSegunPref=function(idCategoria,preferencias,limit){var defered=$q.defer();var promise=defered.promise;$http.post("/app/elementos/busqueda/fuentes",{categoria:idCategoria,preferencias:preferencias,tipo:"FUENTE",limit:limit}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.listarIconosSegunTags=function(tags,idCategoria,ids,limit){var defered=$q.defer();var promise=defered.promise;$http.post("/app/elementos/busqueda/iconos",{tags:tags,categoria:idCategoria,ids:ids,limit:limit}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.listarFuentes=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/elementos/fuente").then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.listarIniciales=function(inicial){var defered=$q.defer();var promise=defered.promise;$http.post("/app/elementos/iniciales",{inicial:inicial}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise}}]).service("pedidosService",["$http","$q",function($http,$q){this.listarPlanes=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/planes/comprar").then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.listarPasarelas=function(idMoneda){var defered=$q.defer();var promise=defered.promise;$http.post("/app/pasarelas/moneda",{idMoneda:idMoneda}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.pagar={paypal:function(idElemento,atributos,logo,idPrecio,tipoLogo,idPasarela){var defered=$q.defer();var promise=defered.promise;var datos={idElemento:idElemento,logo:logo,idPrecio:idPrecio,tipoLogo:tipoLogo,idPasarela:idPasarela,atributos:atributos};$http.post("/app/pedido",datos).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise},stripe:function(idElemento,atributos,logo,idPrecio,tipoLogo,idPasarela,tokenStripe){var defered=$q.defer();var promise=defered.promise;var datos={idElemento:idElemento,logo:logo,idPrecio:idPrecio,tipoLogo:tipoLogo,idPasarela:idPasarela,atributos:atributos,stripeToken:tokenStripe};$http.post("/app/pedido",datos).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise}};this.listarPedidos=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/cliente/pedidos").then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise}}]).factory("clienteDatosFactory",[function(){var cliente=null;return{obtener:function(){return cliente},definir:function(objectoCliente){cliente=objectoCliente},eliminar:function(){cliente=null}}}]).service("socialAuth",["$http","$q","$window","clienteDatosFactory",function($http,$q,$window,clienteDatosFactory){this.facebook=function(){var defered=$q.defer();var promise=defered.promise;FB.getLoginStatus(function(response){var datosUsuario=response.authResponse;if(response.status!="connected"){FB.login(function(response){$http.post("/app/cliente/social",{origen:"facebook",token:response.authResponse.accessToken}).then(function(res){$window.localStorage.setItem("bzToken",angular.toJson(res.data));clienteDatosFactory.definir(res.data);defered.resolve(res)}).catch(function(res){$window.localStorage.removeItem("bzToken");defered.reject(res)})},{scope:"email,user_friends,user_location,user_likes"});return promise}$http.post("/app/cliente/social",{origen:"facebook",token:datosUsuario.accessToken}).then(function(res){$window.localStorage.setItem("bzToken",angular.toJson(res.data));clienteDatosFactory.definir(res.data);defered.resolve(res)}).catch(function(res){$window.localStorage.removeItem("bzToken");defered.reject(res)})});return promise};this.google=function(){var defered=$q.defer();var promise=defered.promise;var GoogleAuth=gapi.auth2.getAuthInstance();if(!GoogleAuth.isSignedIn.get()){GoogleAuth.signIn().then(function(res){$http.post("/app/cliente/social",{origen:"google",token:res.Zi.id_token}).then(function(res){$window.localStorage.setItem("bzToken",angular.toJson(res.data));clienteDatosFactory.definir(res.data);defered.resolve(res)}).catch(function(res){$window.localStorage.removeItem("bzToken");defered.reject(res)})}).catch(function(res){defered.reject(res)});return promise}var datosUsuario=GoogleAuth.currentUser.get();$http.post("/app/cliente/social",{origen:"google",token:datosUsuario.Zi.id_token}).then(function(res){$window.localStorage.setItem("bzToken",angular.toJson(res.data));clienteDatosFactory.definir(res.data);defered.resolve(res)}).catch(function(res){$window.localStorage.removeItem("bzToken");defered.reject(res)});return promise}}]).service("facebookService",["$http","$q",function($http,$q){this.compartir=function(){var defered=$q.defer();var promise=defered.promise;FB.getLoginStatus(function(response){if(response.status==="connected"){FB.ui({method:"share",href:"http://test.logo.pro/",source:"http://test.logo.pro/logo.pro.svg"},function(response){if(response&&!response.error_code){if(typeof response!="undefined"){defered.resolve()}}else{defered.reject(response)}})}else{FB.login(function(response){FB.ui({method:"share",href:"http://test.logo.pro/",source:"http://test.logo.pro/"},function(response){if(response&&!response.error_code){if(typeof response!="undefined"){defered.resolve(response)}}else{defered.reject(response)}})})}});return promise}}]).service("clientesService",["$http","$q","$window","$rootScope","clienteDatosFactory","Upload",function($http,$q,$window,$rootScope,clienteDatosFactory,Upload){this.registrar=function(nombreCliente,correo,pass,telefono,pais){var defered=$q.defer();var promise=defered.promise;$http.post("/app/cliente",{nombreCliente:nombreCliente,correo:correo,pass:pass,telefono:telefono,pais:pais}).then(function(res){$window.localStorage.setItem("bzToken",angular.toJson(res.data));clienteDatosFactory.definir(res.data);defered.resolve()}).catch(function(res){$window.localStorage.removeItem("bzToken");defered.reject(res)});return promise};this.login=function(datos){var defered=$q.defer();var promise=defered.promise;$http.post("/app/cliente/login",datos).then(function(res){$window.localStorage.setItem("bzToken",angular.toJson(res.data));clienteDatosFactory.definir(res.data);defered.resolve()}).catch(function(){$window.localStorage.removeItem("bzToken");defered.reject()});return promise};this.forgotPass=function(datos){var defered=$q.defer();var promise=defered.promise;$http.post("/app/recuperar-password",datos).then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res)});return promise};this.confirmarToken=function(datos){var defered=$q.defer();var promise=defered.promise;$http.get("/app/recuperar-password/"+datos).then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res)});return promise};this.cambiarContrasena=function(datos){var defered=$q.defer();var promise=defered.promise;$http.post("/app/cambiar-password",datos).then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res)});return promise};this.verificarCambiaContrasena=function(datos){var defered=$q.defer();var promise=defered.promise;$http.post("/app/cliente/cambiar-contrasena",datos).then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res)});return promise};this.autorizado=function(emitir){if(clienteDatosFactory.obtener()){if(emitir){$rootScope.$broadcast("sesionInicio","true")}return clienteDatosFactory.obtener()}else{if($window.localStorage.getItem("bzToken")){clienteDatosFactory.definir(angular.fromJson($window.localStorage.getItem("bzToken")));if(emitir){$rootScope.$broadcast("sesionInicio","true")}return clienteDatosFactory.obtener()}else{return false}}};this.salir=function(emitir,desactivarAlerta){$window.localStorage.removeItem("bzToken");clienteDatosFactory.eliminar();if(emitir){$rootScope.$broadcast("sesionExpiro")}if(!desactivarAlerta){alert("Alerta Sesion Expiro")}};this.pais=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/pais").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.datos=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/cliente/datos").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.modificar=function(nombreCliente,telefono,pais){var defered=$q.defer();var promise=defered.promise;$http.post("/app/cliente/modificar",{telefono:telefono,nombreCliente:nombreCliente,pais:pais}).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.avatar=function(imagen){var defered=$q.defer();var promise=defered.promise;Upload.upload({url:"/app/cliente/avatar",data:{avatar:imagen}}).then(function(res){defered.resolve(res.data.foto)}).catch(function(){});return promise};this.correoDisponible=function(correo){var defered=$q.defer();var promise=defered.promise;$http.post("/app/cliente/email",{email:correo}).then(function(){defered.reject()}).catch(function(res){if(res.status==404){defered.resolve()}else{defered.reject()}});return promise}}]).factory("compararLogosFactory",[function(){var logos={comparar:[],comprar:""};var informacion={definir:function(valor,tipo){if(tipo=="comprar"){logos.comprar=valor}else if(tipo=="comparar"){logos.comparar.push(valor)}},obtener:function(tipo){if(tipo=="comprar"){return logos.comprar}else if(tipo=="comparar"){return logos.comparar}}};return informacion}]).factory("compartirFactory",[function(){var estados=[];var informacion={definir:function(nombre,valor){estados[nombre]=valor},obtener:function(nombre){return estados[nombre]}};return informacion}]).factory("crearLogoFactory",[function(){return function(iconos,fuentes){var logos=[];angular.forEach(iconos,function(icono,indice){var logo={icono:iconos[indice],fuente:fuentes[indice]};logos.push(logo)});return logos}}]).factory("LS",["$window",function($window){return{definir:function(llave,valor){$window.localStorage.setItem(llave,angular.toJson(valor))},obtener:function(llave){return angular.fromJson($window.localStorage.getItem(llave))}}}]).service("logosService",["$http","$q","$httpParamSerializer",function($http,$q,$httpParamSerializer){this.calificar=function(idLogo,calificacion,comentario){var defered=$q.defer();var promise=defered.promise;var datos={calificacion:calificacion,comentario:comentario,idLogo:idLogo};$http.post("/app/logo/calificar-cliente",datos).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.guardarLogo=function(logo,tipoLogo,idElemento,fuentePrincipalId,fuenteEsloganId,logoPadreId){var defered=$q.defer();var promise=defered.promise;var datos={logo:logo,tipoLogo:tipoLogo,idElemento:idElemento,atributos:{principal:fuentePrincipalId}};if(fuenteEsloganId){datos.atributos.eslogan=fuenteEsloganId}if(logoPadreId){datos.atributos.padre=logoPadreId}$http.post("/app/logo/guardar",datos).then(function(res){defered.resolve(res.data.insertId)}).catch(function(res){defered.reject(res)});return promise};this.modificarLogo=function(logo,idlogo,fuentePrincipalId,fuenteEsloganId){var defered=$q.defer();var promise=defered.promise;var datos={logo:logo,idLogo:idlogo,atributos:{principal:fuentePrincipalId}};if(fuenteEsloganId){datos.atributos.eslogan=fuenteEsloganId}$http.post("/app/logo/modificar",datos).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.mostrarGuardados=function(){var defered=$q.defer();var promise=defered.promise;$http.post("/app/logos/guardados/").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.mostrarComprados=function(){var defered=$q.defer();var promise=defered.promise;$http.post("/app/logos/descargables/").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.mostrarAprobados=function(idLogo){var defered=$q.defer();var promise=defered.promise;var datos={};if(idLogo){datos.idLogo=idLogo}$http.post("/app/logos/aprobados",datos).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.mostrarDestacados=function(){var defered=$q.defer();var promise=defered.promise;$http.post("/app/logos/aprobados/destacados").then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.descargarLogo=function(idLogo,ancho,nombre,tipo,plantilla){var defered=$q.defer();var promise=defered.promise;var datos={idLogo:idLogo,ancho:ancho,descarga:nombre,tipo:tipo,plantilla:plantilla};$http.get("/app/logo/zip/",{params:datos,responseType:"arraybuffer"}).then(function(res){defered.resolve({data:res.data,headers:res.headers()})}).catch(function(res){defered.reject(res)});return promise};this.descargarTodo=function(idLogo,formatosPNG){var defered=$q.defer();var promise=defered.promise;var datos={idLogo:idLogo,formatos:formatosPNG};$http.get("/app/logo/descargar/",{params:datos,responseType:"arraybuffer"}).then(function(res){defered.resolve({data:res.data,headers:res.headers()})}).catch(function(res){defered.reject(res)});return promise};this.obtenerPorId=function(idLogo){var defered=$q.defer();var promise=defered.promise;$http.get("/app/logo/"+idLogo).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.borrarLogo=function(idLogo){var defered=$q.defer();var promise=defered.promise;$http.get("/app/logo/borrar/"+idLogo).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()});return promise};this.manualMarca=function(id){var defered=$q.defer();var promise=defered.promise;$http.get("/app/cliente/manual/"+id).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.enviarPorEmail=function(idLogo,email,url){var defered=$q.defer();var promise=defered.promise;$http.post("/app/logo/compartir-email",{idLogo:idLogo,email:email,url:url}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise}}]).service("planesService",["$http","$q",function($http,$q){this.listar=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/planesAll").then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.porLogo=function(idLogo){var defered=$q.defer();var promise=defered.promise;$http.post("/app/logo/plan/caracteristicas",{idLogo:idLogo}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.aumentarPlan=function(idPlan){var defered=$q.defer();var promise=defered.promise;$http.post("/app/planes/aumentar",{idPlan:idPlan}).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise};this.aumentarPedidoPlan=function(datos){var defered=$q.defer();var promise=defered.promise;$http.post("/app/pedido/aumentar",datos).then(function(res){defered.resolve(res.data)}).catch(function(res){defered.reject(res)});return promise}}]).factory("AuthInterceptor",function($window,$q,$rootScope,clienteDatosFactory){function salir(){$window.localStorage.removeItem("bzToken");clienteDatosFactory.eliminar();$rootScope.$broadcast("sesionExpiro","true")}function autorizado(){if(clienteDatosFactory.obtener()){return clienteDatosFactory.obtener()}else{if($window.localStorage.getItem("bzToken")){clienteDatosFactory.definir(angular.fromJson($window.localStorage.getItem("bzToken")));return clienteDatosFactory.obtener()}else{return false}}}return{request:function(config){config.headers=config.headers||{};if(autorizado()){config.headers.auth=autorizado().token}return config||$q.when(config)},response:function(response){return response||$q.when(response)},responseError:function(response){if(response.status===401||response.status===403){salir()}return $q.reject(response)}}}).factory("arrayToJsonMetasFactory",[function(){return function(arrayMetas){var jsonMetas={};angular.forEach(arrayMetas,function(meta){jsonMetas[meta.clave]=meta.valor});return jsonMetas}}]).factory("mostrarPopAyudaFactory",["$rootScope",function($rootScope){return function(indice){$rootScope.$broadcast("bazamAyuda:mostrar",{indice:indice})}}]).factory("mostrarPasoPopAyudaFactory",["$rootScope",function($rootScope){var accion=true;return function(){$rootScope.$broadcast("bazamPasoAyuda:mostrar",accion);accion=!accion}}]).factory("verificarBase64Factory",[function(){return function(cadena){return/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$/.test(cadena)}}]).factory("fontFactory",["$document",function($document){return{check:function(fuente){if(!$document[0].fonts){return false}return $document[0].fonts.check("200px "+fuente)},load:function(fuente,url){if(!$document[0].fonts){var nombreFuente=fuente.replace(/\s/g,"-");if(!angular.element("."+nombreFuente).length){angular.element("html head").append("<style class='"+nombreFuente+"'>@font-face {font-family: "+fuente+";src: url('"+url+"');}</style>")}return false}var newFuente=new FontFace(fuente,"url("+url+")");$document[0].fonts.add(newFuente);return newFuente.load()}}}]).service("fontService",["$q","$document","fontFactory","$timeout",function($q,$document,fontFactory,$timeout){this.preparar=function(fuente,url){if(!url){url="/fuentes/"+fuente+".ttf"}var defered=$q.defer();var promise=defered.promise;if(fontFactory.check(fuente)){defered.resolve({fuente:fuente,url:url})}else{$q.race([$timeout(function(){return"exceso"},1e4),fontFactory.load(fuente,url)]).then(function(res){if(res==="exceso"){defered.reject()}else{defered.resolve({fuente:fuente,url:url})}}).catch(function(res){defered.reject(res)})}return promise};this.agregarGeneral=function(fuentes){var fontService=this;angular.forEach(fuentes,function(fuente){fontService.preparar(fuente.nombre,fuente.url).catch(function(res){console.log(res)})})}}]).service("papeleriaService",["$q","$http",function($q,$http){this.listarPorCliente=function(){var defered=$q.defer();var promise=defered.promise;$http.get("/app/papeleria/usuario").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()}).finally(function(){});return promise};this.listarPorClienteYlogo=function(id){var defered=$q.defer();var promise=defered.promise;$http.get("/app/papeleria/logo/"+id).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()}).finally(function(){});return promise};this.piezas={guardar:function(tipo,modelo,pieza){var defered=$q.defer();var promise=defered.promise;$http.post("/app/papeleria/pieza",{tipo:tipo,modelo:modelo,pieza:pieza}).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()}).finally(function(){});return promise},eliminar:function(idPieza){var defered=$q.defer();var promise=defered.promise;$http.get("/app/papeleria/pieza/"+idPieza+"/eliminar").then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()}).finally(function(){});return promise},descargar:function(id,idlogo){var defered=$q.defer();var promise=defered.promise;let datos={_id:id,idLogo:idlogo};$http.post("/app/papeleria/descargar",datos).then(function(res){defered.resolve(res.data)}).catch(function(){defered.reject()}).finally(function(){});return promise}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamPapeleria",["fontService","$document","$q","papeleriaService","$mdToast",function(fontService,$document,$q,papeleriaService,$mdToast){return{restrict:"AE",scope:true,controller:["$scope",function($scope){}],link:function(scope,element){var bz=scope.$parent.papeleriaEditor;function pintarLienzo(lienzo){lienzo.find(".color-primario").css({fill:bz.logo.atributos["color-icono"]});if(bz.logo.atributos["color-icono"]===bz.logo.atributos["color-nombre"]){lienzo.find(".color-secundario").css("fill",lienzo.find(".color-primario").css("fill").replace("rgb","rgba").replace(")",", 0.5)"))}else{lienzo.find(".color-secundario").css("fill",bz.logo.atributos["color-nombre"])}}function aplicarAlteraciones(elementoData,indice,elemento,elementoSvg){var elementoDOM;if(elemento=="item"){elementoDOM=elementoSvg.find("g[data-index="+indice+"]");console.log("deberia ser item, es:")}else if(elemento=="logo"){elementoDOM=elementoSvg;console.log("deberia ser logo, es:")}angular.forEach(elementoData.alteraciones,function(alteracion,llave){switch(llave){case"matrix":var matrix=alteracion;for(var i=0;i<matrix.length;i++){matrix[i]=parseFloat(matrix[i])}var newMatrix="matrix("+matrix.join(" ")+")";console.log(elemento);elementoDOM.attr("transform",newMatrix);break}})}function agregarHook(hook,caraSvg){var defered=$q.defer();var promise=defered.promise;fontService.preparar(hook.fuente.nombre,hook.fuente.url).finally(function(){var hookSvg=angular.element($document[0].createElementNS("http://www.w3.org/2000/svg","foreignObject"));hookSvg.attr("id",hook.id);hookSvg.addClass("hook");hookSvg.css({"font-family":hook.fuente.nombre,fill:hook.fuente.fill});hookSvg.append("<svg style='width:100%; height: 100%;'></svg>");caraSvg.append(hookSvg);angular.forEach(hook.caracteristicas,function(caracteristica,llave){hookSvg.attr(llave,caracteristica)});angular.forEach(hook.items,function(item,indice){agregarItem(item,indice,hook,hookSvg)});angular.forEach(hook.items,function(item,indice){aplicarAlteraciones(item,indice,"item",hookSvg)});defered.resolve()});return promise}function agregarItem(item,indice,hook,hookSvg,conservarAlteraciones){var itemSvg=angular.element($document[0].createElementNS("http://www.w3.org/2000/svg","g"));var textSvg=angular.element($document[0].createElementNS("http://www.w3.org/2000/svg",item.tag));itemSvg.append(textSvg);itemSvg.attr("data-index",indice);hookSvg.children().append(itemSvg);var iconoTexto;var contenedorIconoSvg;var iconoSvg;if(item.icono){var contenedorIconoSvg=angular.element($document[0].createElementNS("http://www.w3.org/2000/svg","foreignObject"));iconoSvg=angular.element(item.icono.svg);contenedorIconoSvg.append(iconoSvg);angular.forEach(item.icono.clases,function(clase){iconoSvg.addClass(clase)});if(item.icono.orientacion=="right"){itemSvg.append(contenedorIconoSvg)}else if(item.icono.orientacion=="left"){itemSvg.prepend(contenedorIconoSvg)}}var multilineas=0;var tamanoLineas=0;if(Array.isArray(item.valor)){angular.forEach(item.valor,function(trozoText){trozoTextSvg=angular.element($document[0].createElementNS("http://www.w3.org/2000/svg","tspan"));trozoTextSvg.text(trozoText);textSvg.append(trozoTextSvg);tamanoLineas+=trozoTextSvg[0].getBBox().height;multilineas++})}else{textSvg.text(item.valor)}angular.forEach(item.caracteristicas,function(caracteristica,llave){textSvg.attr(llave,caracteristica)});if(multilineas){if(multilineas<=2){var tamanoTexto=hook.tamanoTexto}else if(multilineas>2){var tamanoTexto=parseInt(hook.tamanoTexto)/multilineas*2}itemSvg.css({"font-size":tamanoTexto})}else{itemSvg.css({"font-size":hook.tamanoTexto})}var coordenadasItem=itemSvg[0].getBBox();var tamanoIcono=parseInt(hook.tamanoTexto)*2;var coordenadasHook=hookSvg[0].getBBox();var coordenadasTexto=textSvg[0].getBBox();var coordenadasContenedor;switch(hook.orientacion){case"right":textSvg.attr("text-anchor","end");if(item.icono){contenedorIconoSvg.attr("height",tamanoIcono);contenedorIconoSvg.attr("width",tamanoIcono);iconoSvg.attr("height","100%");iconoSvg.attr("width","100%");coordenadasContenedor=contenedorIconoSvg[0].getBBox();if(item.icono.orientacion=="right"){contenedorIconoSvg.attr("x",coordenadasHook.width-coordenadasContenedor.width);coordenadasContenedor=contenedorIconoSvg[0].getBBox();if(multilineas){textSvg.children().attr("x",coordenadasContenedor.x*.95)}else{textSvg.attr("x",coordenadasContenedor.x*.95)}}else if(item.icono.orientacion=="left"){if(multilineas){textSvg.children().attr("x","100%")}else{textSvg.attr("x","100%")}coordenadasTexto=textSvg[0].getBBox();contenedorIconoSvg.attr("x",coordenadasHook.width-coordenadasTexto.width-coordenadasContenedor.width)}if(multilineas){coordenadasContenedor=contenedorIconoSvg[0].getBBox();if(coordenadasContenedor.height>tamanoLineas){contenedorIconoSvg.attr("y","0")}else if(coordenadasContenedor.height<=tamanoLineas){if(indice===0){coordenadasTexto=textSvg[0].getBBox();textSvg.attr("y",coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{var coordenadasTrozo=trozoTextSvg[0].getBBox();trozoTextSvg.attr("dy",alturaLinea)}})}else{var itemAnterior=hookSvg.children().find("g:nth-child("+indice+")");var alturaAnterior=alturaAnterior=itemAnterior[0].getBBox().y+itemAnterior[0].getBBox().height;textSvg.attr("y",alturaAnterior+coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{trozoTextSvg.attr("dy",alturaLinea)}})}coordenadasTexto=textSvg[0].getBBox();contenedorIconoSvg.attr("y",coordenadasTexto.y+coordenadasTexto.height/2-coordenadasContenedor.height/2)}}else{if(indice===0){contenedorIconoSvg.attr("y","0")}else{var itemAnterior=hookSvg.children().find("g:nth-child("+indice+")");var alturaAnterior;alturaAnterior=itemAnterior[0].getBBox().y+itemAnterior[0].getBBox().height;contenedorIconoSvg.attr("y",alturaAnterior);itemSvgAnterior=hookSvg.children().find("g:nth-child("+indice+")");var coordenadasItemAnterior=itemSvgAnterior[0].getBBox()}coordenadasContenedor=contenedorIconoSvg[0].getBBox();textSvg.attr("y",coordenadasContenedor.y+coordenadasContenedor.height/2+coordenadasTexto.height/4)}}else{if(multilineas){textSvg.children().attr("x","100%");if(indice===0){coordenadasTexto=textSvg[0].getBBox();textSvg.attr("y",coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{var coordenadasTrozo=trozoTextSvg[0].getBBox();trozoTextSvg.attr("dy",alturaLinea)}})}else{var itemAnterior=hookSvg.children().find("g:nth-child("+indice+")");var alturaAnterior=alturaAnterior=itemAnterior[0].getBBox().y+itemAnterior[0].getBBox().height;textSvg.attr("y",alturaAnterior+coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{trozoTextSvg.attr("dy",alturaLinea)}})}}else{textSvg.attr("x","100%");if(indice===0){textSvg.attr("y",coordenadasItem.height)}else{itemSvgAnterior=hookSvg.children().find("g:nth-child("+indice+")");var coordenadasItemAnterior=itemSvgAnterior[0].getBBox();textSvg.attr("y",coordenadasItem.height+coordenadasItemAnterior.y+coordenadasItemAnterior.height)}}}break;case"left":textSvg.attr("text-anchor","start");if(item.icono){contenedorIconoSvg.attr("height",tamanoIcono);contenedorIconoSvg.attr("width",tamanoIcono);iconoSvg.attr("height","100%");iconoSvg.attr("width","100%");coordenadasContenedor=contenedorIconoSvg[0].getBBox();if(item.icono.orientacion=="right"){if(multilineas){textSvg.children().attr("x","0")}else{textSvg.attr("x","0")}coordenadasTexto=textSvg[0].getBBox();contenedorIconoSvg.attr("x",coordenadasTexto.width)}else if(item.icono.orientacion=="left"){contenedorIconoSvg.attr("x","0");coordenadasContenedor=contenedorIconoSvg[0].getBBox();if(multilineas){textSvg.children().attr("x",coordenadasContenedor.width*1.05)}else{textSvg.attr("x",coordenadasContenedor.width*1.05)}}if(multilineas){coordenadasContenedor=contenedorIconoSvg[0].getBBox();if(coordenadasContenedor.height>tamanoLineas){}else if(coordenadasContenedor.height<=tamanoLineas){if(indice===0){coordenadasTexto=textSvg[0].getBBox();textSvg.attr("y",coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{trozoTextSvg.attr("dy",alturaLinea)}})}else{var itemAnterior=hookSvg.children().find("g:nth-child("+indice+")");var alturaAnterior=alturaAnterior=itemAnterior[0].getBBox().y+itemAnterior[0].getBBox().height;textSvg.attr("y",alturaAnterior+coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{trozoTextSvg.attr("dy",alturaLinea)}})}coordenadasTexto=textSvg[0].getBBox();contenedorIconoSvg.attr("y",coordenadasTexto.y+coordenadasTexto.height/2-coordenadasContenedor.height/2)}}else{if(indice===0){contenedorIconoSvg.attr("y","0")}else{var itemAnterior=hookSvg.children().find("g:nth-child("+indice+")");var alturaAnterior;alturaAnterior=itemAnterior[0].getBBox().y+itemAnterior[0].getBBox().height;contenedorIconoSvg.attr("y",alturaAnterior);itemSvgAnterior=hookSvg.children().find("g:nth-child("+indice+")");var coordenadasItemAnterior=itemSvgAnterior[0].getBBox()}coordenadasContenedor=contenedorIconoSvg[0].getBBox();textSvg.attr("y",coordenadasContenedor.y+coordenadasContenedor.height/2+coordenadasTexto.height/4)}}else{if(multilineas){textSvg.children().attr("x","0");if(indice===0){coordenadasTexto=textSvg[0].getBBox();textSvg.attr("y",coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{var coordenadasTrozo=trozoTextSvg[0].getBBox();trozoTextSvg.attr("dy",alturaLinea)}})}else{var itemAnterior=hookSvg.children().find("g:nth-child("+indice+")");var alturaAnterior=alturaAnterior=itemAnterior[0].getBBox().y+itemAnterior[0].getBBox().height;textSvg.attr("y",alturaAnterior+coordenadasTexto.height);var alturaLinea=0;textSvg.children().each(function(indiceTrozo){var trozoTextSvg=angular.element(this);if(indiceTrozo===0){trozoTextSvg.attr("dy","0");alturaLinea=trozoTextSvg[0].getBBox().height}else{trozoTextSvg.attr("dy",alturaLinea)}})}}else{textSvg.attr("x","0%");if(indice===0){textSvg.attr("y",coordenadasItem.height)}else{itemSvgAnterior=hookSvg.children().find("g:nth-child("+indice+")");var coordenadasItemAnterior=itemSvgAnterior[0].getBBox();textSvg.attr("y",coordenadasItem.height+coordenadasItemAnterior.y+coordenadasItemAnterior.height)}}}}}var promesasHooks=[];var loader=angular.element("<div></div>");loader.addClass("bazam-loader-papeleria");element.append(loader);angular.forEach(bz.papeleria.modelo.caras,function(cara,index){var caraSvg=angular.element(cara.svg);caraSvg.addClass("cara");caraSvg.attr("data-index",index);if(index){caraSvg.css({visibiliy:"hidden","z-index":"-1"})}var estilos=angular.element("<style></style>");estilos.addClass("estilos-cara");estilos.text(`.total-blanco, .total-blanco * {\n\t\t\t\t\t\t\tstroke: white !important;\n\t\t\t\t\t\t\tfill: white !important;\n\t\t\t\t\t\t}`);caraSvg.prepend(estilos);element.append(caraSvg);angular.forEach(cara.logos,function(logo,indiceLogo){var logoSvg=angular.element("<g class='contenedor-logo' data-index="+indiceLogo+">"+bz.base64.decode(bz.logo.logo)+"</g>");angular.forEach(logo.caracteristicas,function(caracteristica,llave){logoSvg.children().attr(llave,caracteristica)});angular.forEach(logo.clases,function(clase){logoSvg.addClass(clase)});aplicarAlteraciones(logo,indiceLogo,"logo",logoSvg);caraSvg.append(logoSvg)});angular.forEach(cara.hooks,function(hook){promesasHooks.push(agregarHook(hook,caraSvg))})});$q.all(promesasHooks).finally(function(){element.html(element.html());pintarLienzo(element);element.find(".bazam-loader-papeleria").remove()});bz.modificarHook=function(indiceCara,indiceHook,preservarAlteraciones){preservarAlteraciones;var hook=bz.papeleria.modelo.caras[indiceCara].hooks[indiceHook];if(!preservarAlteraciones){angular.forEach(hook.items,function(item,indice){bz.papeleria.modelo.caras[indiceCara].hooks[indiceHook].items[indice].alteraciones={}})}var caraSvg=angular.element("bazam-papeleria svg:nth-child("+(indiceCara+1)+")");var hookSvg=caraSvg.find("foreignObject#"+hook.id);hookSvg.remove();agregarHook(hook,caraSvg).finally(function(){pintarLienzo(element)})};bz.cambiarCara=function(indiceCara){element.find(".cara[data-index]").css("z-index","-1");element.find("[data-index="+indiceCara+"]").css("z-index","1")};bz.elementoFocus=function(indiceCara,indiceHook,accion){var hook=bz.papeleria.modelo.caras[indiceCara].hooks[indiceHook];var caraSvg=angular.element("bazam-papeleria svg:nth-child("+(indiceCara+1)+")");var hookSvg=caraSvg.find("foreignObject#"+hook.id);if(accion){angular.element(".hook-seleccionado").removeClass("hook-seleccionado");hookSvg.addClass("hook-seleccionado")}else{hookSvg.removeClass("hook-seleccionado")}};bz.guardar=function(){if(bz.peticion)return;bz.peticion=true;bz.datos.tipo=bz.papeleria.tipo;bz.datos.modelo=bz.papeleria.modelo.nombre;bz.datos.pieza.caras=[];var caras=angular.copy(bz.papeleria.modelo.caras);angular.forEach(caras,function(cara,indice){var svgCara=angular.element(".cara[data-index="+indice+"]")[0].outerHTML;var nuevaCara={hooks:cara.hooks,nombre:cara.nombre,logos:cara.logos,svg:svgCara};bz.datos.pieza.caras.push(nuevaCara)});papeleriaService.piezas.guardar(bz.datos.tipo,bz.datos.modelo,bz.datos.pieza).then(function(res){$mdToast.show($mdToast.base({args:{mensaje:"¡Ha guardado su pieza!",clase:"success"}}));if(res.insertId){bz.datos.pieza._id=res.insertId._id}else if(res.affectedRow){bz.datos.pieza._id=res.affectedRow._id}}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){bz.peticion=false})};var currentX=0;var currentY=0;var currentMatrix=[];element.on("mouseenter",".hook g, g.contenedor-logo",function(evento){var objetivo=angular.element(evento.currentTarget);objetivo.attr("movimiento-bz","false");angular.element(".rect-bz").remove();var coordenadasObjetivo=objetivo[0].getBBox();var rectangulo=angular.element($document[0].createElementNS("http://www.w3.org/2000/svg","rect"));rectangulo.addClass("rect-bz");rectangulo.css({fill:"transparent",stroke:"black","stroke-width":"1px","stroke-dasharray":"3px"});var cara=objetivo.parents(".cara");var hook=objetivo.parents(".hook");rectangulo.attr("height",coordenadasObjetivo.height);rectangulo.attr("width",coordenadasObjetivo.width);if(hook.length){rectangulo.attr("x",coordenadasObjetivo.x+parseFloat(hook.attr("x")));rectangulo.attr("y",coordenadasObjetivo.y+parseFloat(hook.attr("y")))}else{rectangulo.attr("x",coordenadasObjetivo.x);rectangulo.attr("y",coordenadasObjetivo.y)}rectangulo.attr("transform",objetivo.attr("transform"));cara.append(rectangulo)});element.on("mouseleave",".rect-bz",function(evento){angular.element(".rect-bz").remove();var objetivo=angular.element("[movimiento-bz]");objetivo.removeAttr("movimiento-bz")});element.on("mousedown",".rect-bz",function(evento){var objetivo=angular.element("[movimiento-bz]");objetivo.attr("movimiento-bz","true");if(!objetivo.attr("transform")){objetivo.attr("transform","matrix(1 0 0 1 0 0)")}currentX=evento.clientX;currentY=evento.clientY;currentMatrix=objetivo.attr("transform").slice(7,-1).split(" ");for(var i=0;i<currentMatrix.length;i++){currentMatrix[i]=parseFloat(currentMatrix[i])}});element.on("mousemove",".rect-bz",function(evento){var objetivo=angular.element(evento.currentTarget);if(!angular.element("[movimiento-bz=true]").length){return}var dx=evento.clientX-currentX;var dy=evento.clientY-currentY;var svgPadre=objetivo.parents(".cara")[0];var relacionX=svgPadre.getClientRects()[0].width/parseFloat(element.children().attr("viewBox").split(" ")[2]);var relacionY=svgPadre.getClientRects()[0].height/parseFloat(element.children().attr("viewBox").split(" ")[3]);currentMatrix[4]+=dx/relacionY;currentMatrix[5]+=dy/relacionX;var newMatrix="matrix("+currentMatrix.join(" ")+")";objetivo.attr("transform",newMatrix);angular.element("[movimiento-bz]").attr("transform",newMatrix);currentX=evento.clientX;currentY=evento.clientY});angular.element("body").mouseup(function(){var objetivo=angular.element("[movimiento-bz]");if(!objetivo.length){return}var objetivoElemento=objetivo.hasClass("contenedor-logo")?"logo":"item";if(objetivoElemento==="item"){var indiceCara=objetivo.parents(".cara").data("index");var idHook=objetivo.parents(".hook").attr("id");var indiceItem=objetivo.data("index");var indiceHook;angular.forEach(bz.papeleria.modelo.caras[indiceCara].hooks,function(hookPapeleria,indice){if(idHook==hookPapeleria.id){indiceHook=indice}});if(!bz.papeleria.modelo.caras[indiceCara].hooks[indiceHook].items[indiceItem].alteraciones){bz.papeleria.modelo.caras[indiceCara].hooks[indiceHook].items[indiceItem].alteraciones={}}bz.papeleria.modelo.caras[indiceCara].hooks[indiceHook].items[indiceItem].alteraciones.matrix=currentMatrix}else if(objetivoElemento==="logo"){var indiceCara=objetivo.parents(".cara").data("index");var indiceLogo=objetivo.data("index");if(!bz.papeleria.modelo.caras[indiceCara].logos[indiceLogo].alteraciones){bz.papeleria.modelo.caras[indiceCara].logos[indiceLogo].alteraciones={}}bz.papeleria.modelo.caras[indiceCara].logos[indiceLogo].alteraciones.matrix=currentMatrix}angular.element("[movimiento-bz]").attr("movimiento-bz","false")})}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamMenuPapeleria",[function(){return{restrict:"AE",scope:false,controller:["$scope","$mdToast","$sce",function($scope,$mdToast,$sce){var bz=this;bz.sce=$sce;bz.menuActivo=$scope.papeleriaEditor.papeleria.modelo.caras[0].nombre;$scope.agregarElementoHook=function(indiceCara,indiceHook,indiceElemento){var hook=$scope.papeleriaEditor.papeleria.modelo.caras[indiceCara].hooks[indiceHook];var item=$scope.papeleriaEditor.papeleria.items[indiceElemento];var itemAgregar=$scope.papeleriaEditor.papeleria.modelo.itemsDefaults[item.nombre];itemAgregar.tag=item.tag;itemAgregar.tipo=item.tipo;itemAgregar.nombre=item.nombre;if(hook.items.length==hook.limite)return $mdToast.show($mdToast.base({args:{mensaje:"El contenedor ha llegado al limite de elementos. Elimine alguno o elija otro contenedor.",clase:"danger"}}));for(var i=0;i<hook.items.length;i++){if(hook.items[i].nombre==item.nombre)return $mdToast.show($mdToast.base({args:{mensaje:"El contenedor ya contiene un elemento "+item.nombre+", Elija otro elemento.",clase:"danger"}}))}$scope.papeleriaEditor.papeleria.modelo.caras[indiceCara].hooks[indiceHook].items.push(itemAgregar);$scope.$apply();$scope.papeleriaEditor.modificarHook(indiceCara,indiceHook)};bz.eliminarItemHook=function(indiceCara,indiceHook,indiceItem){var hook=$scope.papeleriaEditor.papeleria.modelo.caras[indiceCara].hooks[indiceHook];hook.items.splice(indiceItem,1);$scope.papeleriaEditor.modificarHook(indiceCara,indiceHook)};bz.move=function(accion,indiceCara,indiceHook,indiceElemento){var nuevoIndice=indiceElemento+accion;var elementos=$scope.papeleriaEditor.papeleria.modelo.caras[indiceCara].hooks[indiceHook].items;if(nuevoIndice<0||nuevoIndice==elementos.length)return;var indexes=[indiceElemento,nuevoIndice].sort();elementos.splice(indexes[0],2,elementos[indexes[1]],elementos[indexes[0]]);$scope.papeleriaEditor.modificarHook(indiceCara,indiceHook)};bz.cambiarDireccionElemento=function(elemento,indiceCara,indiceHook){var cambio=function(direccion){if(elemento.items.length>0){angular.forEach(elemento.items,function(item){if(item.icono!=null){item.icono.orientacion=direccion}})}};if(elemento.orientacion=="right"){elemento.orientacion="left";if(elemento.id){cambio("left")}}else{elemento.orientacion="right";if(elemento.id){cambio("right")}}$scope.papeleriaEditor.modificarHook(indiceCara,indiceHook)};bz.cambiarFuente=function(fuente,indiceCara,indiceHook){var hook=$scope.papeleriaEditor.papeleria.modelo.caras[indiceCara].hooks[indiceHook];hook.fuente.nombre=fuente.nombre;hook.fuente.url=fuente.url;$scope.papeleriaEditor.modificarHook(indiceCara,indiceHook,true)}}],controllerAs:"menuPapeleria",templateUrl:"app/templates/bazamMenuPapeleria.tpl"}}]).directive("droppableHookPapeleria",function(){return{restrict:"A",link:function(scope,element){element.droppable({drop:function(event){scope.agregarElementoHook(scope.$parent.$index,scope.$index,parseInt(event.originalEvent.target.getAttribute("indice")))}})}}})},function(module,exports){angular.module("disenador-de-logos").directive("bazamCrearPapeleria",[function(){return{restrict:"AE",scope:{estado:"=",idLogo:"<",papelerias:"="},controller:["$scope","$mdToast","$sce","$stateParams","$state",function($scope,$mdToast,$sce,$stateParams,$state){var bz=this;bz.sce=$sce;bz.idLogo=$scope.idLogo;$scope.papeleriaActiva=$scope.papelerias[0].tipo;bz.enviarEditor=function(indicePapeleria,indiceModelo){var papeleria=angular.copy($scope.papelerias[indicePapeleria]);delete papeleria.modelos;var modelo=angular.copy($scope.papelerias[indicePapeleria].modelos[indiceModelo]);if(modelo.piezas){delete modelo.piezas}var datos={papeleria:papeleria,modelo:modelo};$state.go("papeleriaEditor",{id:bz.idLogo,papeleria:datos})}}],controllerAs:"crearPapeleria",templateUrl:"app/templates/bazamCrearPapeleria.tpl"}}])},function(module,exports){angular.module("disenador-de-logos").directive("stripePaymentForm",["$document",function($document){return{templateUrl:"app/templates/stripePaymentsForm.tpl",scope:{icono:"<",atributos:"<",svg:"<",precio:"<",pasarela:"<",logo:"<?"},controller:["$scope","pedidosService","$q","$state","$window","planesService",function($scope,pedidosService,$q,$state,$window,planesService){var defered=$q.defer();var disenadorPromise=defered.promise;$scope.completadoPagar=true;$scope.pagar=function(){if(!$scope.completadoPagar){return}$scope.completadoPagar=false;var stripePromise=$scope.stripe.createToken($scope.card);stripePromise.then(function(res){if(res.error){$scope.mensajeError(res.error.message);defered.reject()}else{if($scope.logo){planesService.aumentarPedidoPlan({idPasarela:$scope.pasarela,idPrecio:$scope.precio,idLogo:$scope.logo,stripeToken:res.token.id}).then(function(){$window.location.reload()}).catch(function(){}).finally(function(){defered.resolve()})}else{pedidosService.pagar.stripe($scope.icono,$scope.atributos,$scope.svg,$scope.precio,"Logo y nombre",$scope.pasarela,res.token.id).then(function(res){$state.go("descargar",{id:res.idLogo})}).catch(function(){$scope.mensajeError("El pago no ha podido ser procesado")}).finally(function(){defered.resolve()})}}});$q.all({stripe:stripePromise,disenador:disenadorPromise}).finally(function(){$scope.completadoPagar=true})}}],link:function(scope,el){scope.stripe=Stripe("pk_test_ODlU80cwnJ5Xr2an9L1XZByL");var elements=scope.stripe.elements();var style={base:{color:"#32325d",lineHeight:"18px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}};scope.card=elements.create("card",{style:style});scope.card.mount("#card-element");scope.card.addEventListener("change",function(event){var displayError=$document[0].getElementById("card-errors");if(event.error){displayError.textContent=event.error.message}else{displayError.textContent=""}});scope.mensajeError=function(mensaje){el.find("#card-errors").text(mensaje)}}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamListarPlanes",[function(){return{templateUrl:"app/templates/listar-planes.tpl",controllerAs:"listarPlanes",scope:{datos:"=",verlogo:"<",promocion:"="},controller:["pedidosService","$scope","$state","$base64","$window","$http","$mdToast","facebookService","logosService","$filter","$timeout","$q","clientesService","$rootScope","$document",function(pedidosService,$scope,$state,$base64,$window,$http,$mdToast,facebookService,logosService,$filter,$timeout,$q,clientesService,$rootScope,$document){var bz=this;bz.base64=$base64;bz.estado=$scope.estado;bz.promocion=$scope.promocion;bz.monedas={};bz.moneda={};bz.monedaDefault={};bz.planes=[];bz.impuesto=0;pedidosService.listarPlanes().then(function(res){bz.monedaDefault={simbolo:res.monedaDefault.codigo,idMoneda:res.monedaDefault.idMoneda};bz.impuesto=res.impuesto;bz.planes=res.planes;angular.forEach(res.planes,function(plan){angular.forEach(plan.precios,function(precio){if(!bz.monedas[precio.moneda]){bz.monedas[precio.moneda]={simbolo:precio.moneda,idMoneda:precio.idMoneda}}})});bz.moneda=bz.monedaDefault}).catch(function(res){});bz.precioSeleccionado=function(precios){var precioFinal="";angular.forEach(precios,function(valor){if(valor.moneda==bz.moneda.simbolo){precioFinal=valor.moneda+" "+valor.precio}});return precioFinal};bz.comprobarMonedas=function(plan){var coincidencia=false;angular.forEach(plan.precios,function(valor){if(valor.moneda==bz.moneda.simbolo){coincidencia=true}});return coincidencia};bz.verificarLogin=function(plan){bz.planElegido=plan;if(!clientesService.autorizado()){$rootScope.mostrarModalLogin=true;$rootScope.callbackLogin=bz.avanzarCheckout;return}bz.avanzarCheckout()};bz.avanzarCheckout=function(){var plan=bz.planElegido;bz.logo=$scope.datos.logo;bz.idElemento=$scope.datos.idElemento;bz.fuentes={principal:$scope.datos.fuentes.principal,eslogan:$scope.datos.fuentes.eslogan};bz.colores=$scope.datos.colores;if(plan===true){angular.element(document.querySelector(".overlay.full")).fadeIn(1e3);bz.peticion=true;var nombre="gratis";var ancho=80;bz.compatirFacebook({url:""}).then(function(res){if($scope.datos.idLogo){logosService.descargarLogo($scope.datos.idLogo,ancho,$filter("uppercase")(nombre),nombre).then(function(res){var cd=res.headers["content-disposition"];var regex=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var match=regex.exec(cd);var fileName=match[1]||"myDefaultFileName.zip";fileName=fileName.replace(/\"/g,"");var contentType=res.headers["content-type"];var blob=new Blob([res.data],{type:contentType});if($window.navigator&&$window.navigator.msSaveOrOpenBlob){$window.navigator.msSaveOrOpenBlob(blob,fileName)}else{var a=$document[0].createElement("a");$document[0].body.appendChild(a);a.style="display:none";var url=$window.URL.createObjectURL(blob);a.href=url;a.download=fileName;a.target="_blank";a.click();$window.URL.revokeObjectURL(url);a.remove()}bz.desabilitado=true;bz.promocion=true;bz.peticion=false;angular.element(document.querySelector(".overlay.full")).fadeOut(1e3)})}else{bz.guardarLogo(bz.logo,"Logo y nombre",$scope.datos.idElemento,$scope.datos.fuentes.principal,true).then(function(res){logosService.descargarLogo(res,ancho,$filter("uppercase")(nombre),nombre).then(function(res){var cd=res.headers["content-disposition"];var regex=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var match=regex.exec(cd);var fileName=match[1]||"myDefaultFileName.zip";fileName=fileName.replace(/\"/g,"");var contentType=res.headers["content-type"];var blob=new Blob([res.data],{type:contentType});if($window.navigator&&$window.navigator.msSaveOrOpenBlob){$window.navigator.msSaveOrOpenBlob(blob,fileName)}else{var a=$document[0].createElement("a");$document[0].body.appendChild(a);a.style="display:none";var url=$window.URL.createObjectURL(blob);a.href=url;a.download=fileName;a.target="_blank";a.click();$window.URL.revokeObjectURL(url);a.remove()}angular.element(document.querySelector(".overlay.full")).fadeOut(1e3)}).catch(function(res){console.log(res);angular.element(document.querySelector(".overlay.full")).fadeOut(1e3)}).finally(function(){bz.desabilitado=true;bz.promocion=true;bz.peticion=false})})}}).catch(function(res){if(res==="exceso"){$mdToast.show($mdToast.base({args:{mensaje:"Tiempo excedido, Debes compartir en facebook para obtener tu logo gratis.",clase:"danger"}}));angular.element(document.querySelector(".overlay.full")).fadeOut(1e3);return}$mdToast.show($mdToast.base({args:{mensaje:"Debes compartir en facebook para obtener tu logo gratis.",clase:"danger"}}));bz.peticion=false;angular.element(document.querySelector(".overlay.full")).fadeOut(1e3)}).finally(function(){bz.peticion=false});return}angular.forEach(plan.precios,function(precio){if(precio.moneda==bz.moneda.simbolo){var datosPago={status:true,datos:{logo:$scope.datos.logo,idElemento:bz.idElemento,tipo:"Logo y nombre",plan:{nombre:plan.plan,idPlan:plan.idPlan},precio:{moneda:{simbolo:precio.moneda,idMoneda:precio.idMoneda},monto:precio.precio,idPrecio:precio.idPrecio},impuesto:bz.impuesto,atributos:{principal:bz.fuentes.principal,"color-nombre":bz.colores.nombre,"color-icono":bz.colores.icono}}};if($scope.datos.idPadre){datosPago.datos.atributos.padre=$scope.datos.idPadre}if(bz.fuentes.eslogan){datosPago.datos.atributos.eslogan=bz.fuentes.eslogan}if(bz.colores.eslogan){datosPago.datos.atributos["color-eslogan"]=bz.colores.eslogan}$state.go("pago",datosPago)}})};bz.compatirFacebook=function(){var defered=$q.defer();var promise=defered.promise;var promesas=[$timeout(function(){return"exceso"},6e4),facebookService.compartir()];$q.race(promesas).then(function(res){if(res==="exceso"){defered.reject("exceso")}else{defered.resolve(res)}}).catch(function(){defered.reject()});return promise};bz.guardarLogo=function(logo,tipoLogo,idElemento,idFuentePrincipal){var defered=$q.defer();var promise=defered.promise;logosService.guardarLogo(bz.base64.encode(logo),tipoLogo,idElemento,idFuentePrincipal).then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res)});return promise}}]}}]).directive("bazamPlanes",[function(){return{templateUrl:"app/templates/planes.tpl",controllerAs:"planes",scope:{datos:"=",estado:"="}}}]).directive("bazamPrevisualizarDos",[function(){return{templateUrl:"app/templates/ver-logo.tpl",scope:{datos:"=",estado:"="}}}])},function(module,exports){angular.module("disenador-de-logos").directive("draggable",function(){return{restrict:"A",link:function(scope,element,attrs){element.draggable({revert:true})}}}).directive("resizable",function(){return{restrict:"A",link:function(scope,element,attrs){element.resizable()}}})},function(module,exports){angular.module("disenador-de-logos").directive("bazamVisualizar",function(){return{restrict:"AE",scope:{svg:"=svg"},link:function(scope,element){element.html(scope.svg);element.html(element.html())}}}).directive("bazamActualizar",function(){return{restrict:"AE",scope:{svg:"<svg"},link:function(scope,element){element.html(scope.svg);element.html(element.html());scope.$watch("svg",function(){element.html(scope.svg);element.html(element.html())})}}})},function(module,exports){angular.module("disenador-de-logos").directive("bazamSvgText",["fontService","$timeout",function(fontService,$timeout){return{restrict:"AE",scope:{svg:"<",texto:"<",colorTexto:"<colorTexto",colorIcono:"<colorIcono",fuente:"<",url:"<",callback:"="},link:function(scope,element){element.append('<svg class="background-svg" viewbox="0 0 400 400"></svg>');fontService.preparar(scope.fuente,scope.url).then(function(){}).catch(function(){}).finally(function(){{element.find(".background-svg").remove();var tamanoBase=100;scope.svgSaneado=scope.svg.trim();var posicion1=scope.svgSaneado.search(">");scope.svgTagIncompleto=scope.svgSaneado.substr(0,posicion1+1);var posicion2=scope.svgSaneado.substr(posicion1+1).search("</svg>");scope.seccionInterna=scope.svgSaneado.substr(posicion1+1).substr(0,posicion2);scope.seccionInternaElementos=[];scope.elementosIndices=[];scope.seccionInterna.trim().split(">").forEach(function(parte,index){var indiceParte=" data-indice='"+index+"'";if(parte!=""){if(parte.search("</")==-1){if(parte.search("/")==-1){scope.seccionInternaElementos.push(parte+indiceParte+">")}else{scope.seccionInternaElementos.push(parte.replace("/","")+indiceParte+"/>")}}else{scope.seccionInternaElementos.push(parte+">")}}scope.elementosIndices.push(false)});scope.seccionInterna=scope.seccionInternaElementos.join("");scope.svgTag=scope.svgTagIncompleto+scope.seccionInterna+"</svg>";element[0].innerHTML="<svg viewBox='0 0 "+tamanoBase+" "+tamanoBase+"'><g class='contenedor-icono'>"+scope.svgTag+"</g></svg>";var relacion=element[0].children[0].getClientRects()[0].height/tamanoBase;var svgIcono=element[0].children[0].children[0].children[0];svgIcono.setAttribute("height",tamanoBase/2+"px");svgIcono.setAttribute("fill",scope.colorIcono);var texto=document.createElementNS("http://www.w3.org/2000/svg","text");texto.setAttributeNS(null,"x",tamanoBase/2);var textoNode=document.createTextNode(scope.texto);texto.appendChild(textoNode);element[0].children[0].appendChild(texto);var svgTexto=element[0].children[0].children[1];svgTexto.style.fill=scope.colorTexto;svgTexto.style.fontSize=tamanoBase/2+"px";svgTexto.setAttribute("text-anchor","middle");svgTexto.setAttribute("font-family",scope.fuente);svgTexto.setAttribute("class","textoPrincipal");while(svgTexto.getComputedTextLength()>1.6*svgIcono.height.baseVal.value){svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)-1+"px"}var paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);var paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText);if(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){while(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){svgIcono.setAttribute("height",parseFloat(svgIcono.getAttribute("height"))*.95+"px");svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px"}paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText)}element.children().prepend("<style> @font-face { font-family: '"+scope.fuente+"'; src: url('"+scope.url+"')}  </style>");$timeout(function(){scope.callback=element[0].innerHTML},1e3)}})}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamSvg",["$rootScope","fontService","$timeout","$q","coloresPaletaValue",function($rootScope,fontService,$timeout,$q,coloresPaletaValue){return{restrict:"AE",scope:{svg:"=svg",texto:"=texto",fuente:"=fuente",svgFinal:"=svgFinal",idLogo:"=idLogo",idPadre:"=idPadre",eslogan:"=eslogan",colorIcono:"=colorIcono",colorTexto:"=colorTexto"},controller:function($scope){$scope.svgPreparado=$q.defer();if(!$scope.idLogo&&!$scope.idPadre){$scope.fuenteCargada=fontService.preparar($scope.fuente.nombre,$scope.fuente.url);$scope.svgSaneado=$scope.svg.trim();var posicion1=$scope.svgSaneado.search(">");$scope.svgTagIncompleto=$scope.svgSaneado.substr(0,posicion1+1);var posicion2=$scope.svgSaneado.substr(posicion1+1).search("</svg>");$scope.seccionInterna=$scope.svgSaneado.substr(posicion1+1).substr(0,posicion2);$scope.seccionInternaElementos=[];$scope.elementosIndices=[];$scope.seccionInterna.trim().split(">").forEach(function(parte,index){var indiceParte=" data-indice='"+index+"'";if(parte!=""){if(parte.search("</")==-1){if(parte.search("/")==-1){$scope.seccionInternaElementos.push(parte+indiceParte+">")}else{$scope.seccionInternaElementos.push(parte.replace("/","")+indiceParte+"/>")}}else{$scope.seccionInternaElementos.push(parte+">")}}$scope.elementosIndices.push(false)});$scope.seccionInterna=$scope.seccionInternaElementos.join("");$scope.svgTag=$scope.svgTagIncompleto+$scope.seccionInterna+"</svg>"}else if($scope.idLogo||$scope.idPadre){$scope.elementosIndices=[]}},link:{pre:function(scope,element){var tamanoBase=100;if(!scope.idLogo&&!scope.idPadre){scope.fuenteCargada.then(function(){}).catch(function(){}).finally(function(){element[0].innerHTML="<svg viewBox='0 0 "+tamanoBase+" "+tamanoBase+"'><g class='contenedor-icono'>"+scope.svgTag+"</g></svg>";var relacion=element[0].children[0].getClientRects()[0].height/tamanoBase;var svgIcono=element[0].children[0].children[0].children[0];svgIcono.setAttribute("height",tamanoBase/2+"px");svgIcono.setAttribute("fill",scope.colorIcono);var texto=document.createElementNS("http://www.w3.org/2000/svg","text");texto.setAttributeNS(null,"x",tamanoBase/2);var textoNode=document.createTextNode(scope.texto);texto.appendChild(textoNode);element[0].children[0].appendChild(texto);var svgTexto=element[0].children[0].children[1];svgTexto.style.fill=scope.colorTexto;svgTexto.style.fontSize=tamanoBase/2+"px";svgTexto.setAttribute("text-anchor","middle");svgTexto.setAttribute("font-family",scope.fuente.nombre);svgTexto.setAttribute("class","textoPrincipal");while(svgTexto.getComputedTextLength()>1.6*svgIcono.height.baseVal.value){svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)-1+"px"}var paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);var paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText);if(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){while(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){svgIcono.setAttribute("height",parseFloat(svgIcono.getAttribute("height"))*.95+"px");svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px"}paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText)}element.children().prepend("<style> @font-face { font-family: '"+scope.fuente.nombre+"'; src: url('"+scope.fuente.url+"')}  </style>");scope.svgPreparado.resolve()})}else if(scope.idLogo||scope.idPadre){element.html(scope.svg);element.find("g.contenedor-icono > svg [data-indice]").each(function(){scope.elementosIndices[parseInt(this.getAttribute("data-indice"))]=false});scope.texto=element.find("text.textoPrincipal").text();if(element.find("text.eslogan").length){scope.eslogan=element.find("text.eslogan").text()}scope.svgPreparado.resolve()}},post:function(scope,element){scope.svgPreparado.promise.finally(function(){element.html(element.html());scope.svgFinal=element.html();var fuentes={principal:scope.fuente,eslogan:null};var paletaColores=coloresPaletaValue;angular.element("bazam-svg").on("click","g.contenedor-icono > svg :not(g), .textoPrincipal, .eslogan",function(e){var coordenadasCon=angular.element(".svg-container")[0].getBoundingClientRect();var titulo="";var id="";var crearPicker=function(id){if(angular.element("#"+id).length){return}var posicionPicker;switch(id){case"color-picker-icono":posicionPicker={position:"fixed",left:coordenadasCon.right+10,top:coordenadasCon.top-10,width:coordenadasCon.width/1.6,height:coordenadasCon.height/2,"background-color":"white","z-index":"2"};break;case"color-picker-texto":posicionPicker={position:"fixed",left:coordenadasCon.left-coordenadasCon.width/2-10,top:coordenadasCon.top-40,width:coordenadasCon.width/1.6,height:coordenadasCon.height/2,"background-color":"white","z-index":"2"};break;case"color-picker-eslogan":posicionPicker={position:"fixed",left:coordenadasCon.left-coordenadasCon.width/2-10,top:coordenadasCon.top+10+coordenadasCon.height/2,width:coordenadasCon.width/1.6,height:coordenadasCon.height/2,"background-color":"white","z-index":"2"}}var colorPicker=angular.element("<div class='element-color-picker'><div class='title'>"+titulo+" <span class='close-color-picker'><i class='material-icons cerrar'>clear</i></span></div></div>");colorPicker.attr("id",id);colorPicker.css(posicionPicker);angular.forEach(paletaColores,function(color){var colorIndividual=angular.element("<div></div>");colorIndividual.addClass("color");colorIndividual.attr("data-color",color);colorIndividual.css({"background-color":color,width:"4.2%",height:"6.7%",display:"inline-block"});colorPicker.append(colorIndividual)});angular.element(".principal-container.editor").append(colorPicker);colorPicker.draggable({revert:false})};var clicked=angular.element(e.target);if(clicked.hasClass("textoPrincipal")){titulo="NOMBRE";id="color-picker-texto"}else if(clicked.hasClass("eslogan")){titulo="ESLOGAN";id="color-picker-eslogan"}else{titulo="ICONO";id="color-picker-icono"}crearPicker(id);if(clicked.hasClass("textoPrincipal")||clicked.hasClass("eslogan")){return}angular.element(".seleccionado").removeClass("seleccionado");angular.element(this).addClass("seleccionado");var indiceParte=angular.element(this).attr("data-indice");scope.elementosIndices.forEach(function(valor,indice){scope.elementosIndices[indice]=false});scope.elementosIndices[indiceParte]=true});angular.element(".principal-container.editor").on("click","#color-picker-icono, #color-picker-texto, #color-picker-eslogan",function(e){var contenedorColor=angular.element(e.target);var color=contenedorColor.data("color");var colorPicker=contenedorColor.parent();switch(colorPicker.attr("id")){case"color-picker-icono":var indice=scope.elementosIndices.indexOf(true);element.find("[data-indice="+indice+"]").css("fill",color);break;case"color-picker-texto":element.find("text.textoPrincipal").css("fill",color);break;case"color-picker-eslogan":element.find("text.eslogan").css("fill",color)}});angular.element(".principal-container.editor").on("click",".close-color-picker",function(){var colorPicker=angular.element(this).parents(".element-color-picker");if(colorPicker.attr("id")=="color-picker-icono"){angular.element(".seleccionado").removeClass("seleccionado")}colorPicker.remove()});scope.$on("editor:cerrarColorPickers",function(){angular.element(".color-picker-bazam:not(#color-picker-fondo)").remove();angular.element(".seleccionado").removeClass("seleccionado")});scope.$on("editor:texto",function(evento,texto){var textoFinal=texto.texto;var selector=!texto.eslogan?".textoPrincipal":".eslogan";element.find(selector).text(textoFinal);obtenerSVGFinal()});scope.$on("editor:eliminarEslogan",function(){element.find(".eslogan").remove();obtenerSVGFinal()});scope.$on("editor:fuente",function(evento,datos){var selector=datos.objetivo=="texto"?"text.textoPrincipal":"text.eslogan";var keyFuente=datos.objetivo=="texto"?"principal":"eslogan";fuentes[keyFuente]=datos.fuente;var htmlStyle="";if(fuentes.principal&&fuentes.eslogan){htmlStyle="@font-face { font-family: '"+fuentes.principal.nombre+"'; src: url('"+fuentes.principal.url+"')}\n @font-face { font-family: '"+fuentes.eslogan.nombre+"'; src: url('"+fuentes.eslogan.url+"')}"}else if(fuentes.principal){htmlStyle="@font-face { font-family: '"+fuentes.principal.nombre+"'; src: url('"+fuentes.principal.url+"')}"}element.find(selector).attr("font-family",datos.fuente.nombre);element.children().children("style").html(htmlStyle);obtenerSVGFinal()});scope.$on("editor:propiedad",function(evento,propiedad){var selector=propiedad.eslogan?"text.eslogan":"text.textoPrincipal";if(propiedad.propiedad=="bold"){var grosor=element.find(selector).attr("font-weight")=="bold"?"normal":"bold";element.find(selector).attr("font-weight",grosor)}else if(propiedad.propiedad=="cursive"){var estilo=element.find(selector)[0].style.fontStyle=="oblique"?"normal":"oblique";element.find(selector).css("font-style",estilo)}obtenerSVGFinal()});scope.$on("editor:tamano",function(evento,datos){if(datos.objetivo=="texto"||datos.objetivo=="eslogan"){var selector=datos.objetivo=="eslogan"?"text.eslogan":"text.textoPrincipal";var texto=element.find(selector);var tamano="";if(datos.accion){tamano=parseFloat(texto.css("font-size"))+1+"px"}else if(!datos.accion){tamano=parseFloat(texto.css("font-size"))-1+"px"}texto.css("font-size",tamano)}else if(datos.objetivo=="icono"){var icono=element.find("g.contenedor-icono > svg");var alto=parseFloat(icono.attr("height"));var ancho=icono.attr("width")?parseFloat(icono.attr("width")):null;var altoFinal=0;var anchoFinal=0;if(datos.accion){altoFinal=alto+1;anchoFinal=ancho?ancho+1:null}else if(!datos.accion){altoFinal=alto-1;anchoFinal=ancho?ancho-1:null}icono.attr("height",altoFinal+"px");if(anchoFinal){icono.attr("width",anchoFinal+"px")}}obtenerSVGFinal()});var currentX=0;var currentY=0;var currentMatrix=0;angular.element("bazam-svg").on("mousedown","text.eslogan, text.textoPrincipal, g.contenedor-icono svg",function(evento){var selector=evento.currentTarget.tagName=="svg"?"g.contenedor-icono":this;if(!angular.element(selector).attr("transform")){angular.element(selector).attr("transform","matrix(1 0 0 1 0 0)")}angular.element(selector).attr("movimiento-bz",true);currentX=evento.clientX;currentY=evento.clientY;currentMatrix=angular.element(selector).attr("transform").slice(7,-1).split(" ");for(var i=0;i<currentMatrix.length;i++){currentMatrix[i]=parseFloat(currentMatrix[i])}});angular.element("bazam-svg").on("mousemove","text.eslogan[movimiento-bz], text.textoPrincipal[movimiento-bz], g.contenedor-icono[movimiento-bz]",function(evento){if(angular.element("[movimiento-bz]").length){var dx=evento.clientX-currentX;var dy=evento.clientY-currentY;var svgPadre=element[0].children[0];var relacionX=svgPadre.getClientRects()[0].width/parseFloat(element.children().attr("viewBox").split(" ")[2]);var relacionY=svgPadre.getClientRects()[0].height/parseFloat(element.children().attr("viewBox").split(" ")[3]);currentMatrix[4]+=dx/relacionY;currentMatrix[5]+=dy/relacionX;var newMatrix="matrix("+currentMatrix.join(" ")+")";angular.element(this).attr("transform",newMatrix);currentX=evento.clientX;currentY=evento.clientY}});angular.element(document.querySelector("body")).mouseup(function(){angular.element("text.textoPrincipal, g.contenedor-icono, text.eslogan").removeAttr("movimiento-bz");var clon=angular.element(document.querySelector("bazam-svg")).clone();clon.find(".seleccionado").removeClass("seleccionado");scope.$apply(function(){scope.svgFinal=clon.html()})});scope.$on("editor:comparar",function(){$rootScope.$broadcast("directiva:comparar",{svg:element.html(),creacion:Date.now()})});scope.$on("editor:orientacion",function(evento,orientacion){var tamanoBase=100;var svgIcono;var svgTexto;var eslogan;var relacion=element[0].children[0].getClientRects()[0].height/tamanoBase;if(orientacion=="horizontal"){var alturaSVG=tamanoBase;var anchoSVG=tamanoBase;svgIcono=element.find("g.contenedor-icono > svg")[0];svgIcono.setAttribute("height",alturaSVG*.75+"px");svgIcono.setAttribute("width",alturaSVG*.75+"px");svgIcono.parentElement.setAttribute("transform","");svgTexto=element.find("text.textoPrincipal")[0];svgTexto.style.fontSize=alturaSVG*.75/2+"px";svgTexto.setAttribute("text-anchor","left");svgTexto.setAttribute("transform","");var anchoViewBox=parseInt(element[0].children[0].getAttribute("viewBox").split(" ")[3]);while(svgIcono.width.baseVal.value+anchoSVG*.05+svgTexto.getComputedTextLength()>anchoViewBox*.8){svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px";svgIcono.setAttribute("width",svgIcono.width.baseVal.value*.95+"px");svgIcono.setAttribute("height",svgIcono.height.baseVal.value*.95+"px")}var totalEspacioIconoFuente=svgIcono.width.baseVal.value+anchoSVG*.05+svgTexto.getComputedTextLength();var paddingLeft=(anchoSVG-totalEspacioIconoFuente)/2;svgIcono.setAttribute("y",alturaSVG/2-svgIcono.height.baseVal.value/2);svgIcono.setAttribute("x",paddingLeft);svgTexto.setAttribute("x",paddingLeft+(svgIcono.width.baseVal.value+anchoSVG*.05));svgTexto.setAttribute("y",alturaSVG/2+svgTexto.getClientRects()[0].height/relacion/4);if(element.find("text.eslogan").length){eslogan=element.find("text.eslogan")[0];eslogan.setAttribute("transform","");eslogan.setAttribute("text-anchor","left");eslogan.style.fontSize=svgTexto.style.fontSize;eslogan.setAttribute("x",svgTexto.getAttribute("x"));svgTexto.setAttribute("y",alturaSVG/2+svgTexto.getClientRects()[0].height/relacion/4*.5);while(eslogan.getClientRects()[0].height/relacion*1.5>=svgTexto.getClientRects()[0].height/relacion){eslogan.style.fontSize=parseFloat(eslogan.style.fontSize)*.95+"px"}eslogan.setAttribute("y",alturaSVG/2+svgTexto.getClientRects()[0].height/relacion/4*.5+eslogan.getClientRects()[0].height/relacion*.9)}}else if(orientacion=="vertical"){svgIcono=element.find("g.contenedor-icono > svg")[0];svgIcono.setAttribute("height",tamanoBase/2+"px");svgIcono.removeAttribute("width");svgIcono.removeAttribute("x");svgIcono.parentElement.setAttribute("transform","");svgTexto=element.find("text.textoPrincipal")[0];svgTexto.style.fontSize=tamanoBase/2+"px";svgTexto.setAttribute("text-anchor","middle");svgTexto.setAttribute("transform","");svgTexto.setAttribute("x",tamanoBase/2);while(svgTexto.getComputedTextLength()>1.6*svgIcono.height.baseVal.value){svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)-1+"px"}var paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);var paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText);if(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){while(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){svgIcono.setAttribute("height",parseFloat(svgIcono.getAttribute("height"))*.95+"px");svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px"}paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText)}if(element.find("text.eslogan").length){eslogan=element.find("text.eslogan")[0];eslogan.setAttribute("transform","");eslogan.setAttribute("text-anchor","middle");eslogan.style.fontSize=svgTexto.style.fontSize;eslogan.setAttribute("x",tamanoBase/2);while(eslogan.getClientRects()[0].height/relacion*2.5>=svgTexto.getClientRects()[0].height/relacion){eslogan.style.fontSize=parseFloat(eslogan.style.fontSize)*.95+"px"}while(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion+eslogan.getClientRects()[0].height/relacion*1.3>=tamanoBase){svgIcono.setAttribute("height",parseFloat(svgIcono.getAttribute("height"))*.95+"px");svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px";eslogan.style.fontSize=parseFloat(eslogan.style.fontSize)*.95+"px"}var espacioSobrante=tamanoBase-(svgIcono.getClientRects()[0].height+svgTexto.getClientRects()[0].height+eslogan.getClientRects()[0].height)/relacion;svgIcono.setAttribute("y",espacioSobrante/2+"px");svgTexto.setAttribute("y",espacioSobrante/2+(svgIcono.getClientRects()[0].height+svgTexto.getClientRects()[0].height)/relacion+"px");eslogan.setAttribute("y",espacioSobrante/2+(svgIcono.getClientRects()[0].height+svgTexto.getClientRects()[0].height+eslogan.getClientRects()[0].height)/relacion+"px")}}obtenerSVGFinal()});scope.$on("editor:reemplazar",function(evento,icono){var iconoSVG=element.find("g.contenedor-icono > svg");var x=iconoSVG.attr("x");var y=iconoSVG.attr("y");var heightIcono=iconoSVG.attr("height");var widthIcono=iconoSVG.attr("width");var transform=iconoSVG.attr("transform");iconoSVG.parent().html(icono);var iconoSVGcambiado=element.find("g.contenedor-icono > svg");iconoSVGcambiado.attr("x",x);iconoSVGcambiado.attr("y",y);iconoSVGcambiado.attr("height",heightIcono);if(widthIcono){iconoSVGcambiado.attr("width",widthIcono)}if(transform){iconoSVGcambiado.attr("transform",transform)}var indices=[];var seccionInternaElementos=[];iconoSVGcambiado.html().trim().split(">").forEach(function(parte,index){var indiceParte=" data-indice='"+index+"'";if(parte!=""){if(parte.search("</")==-1){if(parte.search("/")==-1){seccionInternaElementos.push(parte+indiceParte+">")}else{seccionInternaElementos.push(parte.replace("/","")+indiceParte+"/>")}}else{seccionInternaElementos.push(parte+">")}}seccionInternaElementos.push(false)});iconoSVGcambiado.html(seccionInternaElementos.join(""));scope.elementosIndices=indices;obtenerSVGFinal()});scope.$on("editor:restaurar",function(evento,svg){element.html(svg);var indices=[];element.find("g.contenedor-icono > svg [data-indice]").each(function(){indices[parseInt(this.getAttribute("data-indice"))]=false});element.find(".seleccionado").removeClass("seleccionado");angular.element(".color-picker-bazam").remove();scope.elementosIndices=indices;var texto=element.find("text.textoPrincipal");scope.texto=texto.text();if(element.find("text.eslogan").length){var eslogan=element.find("text.eslogan");scope.eslogan=eslogan.text();$rootScope.$broadcast("directiva:restaurarEslogan",{accion:true,fuente:eslogan.attr("font-family")})}else{$rootScope.$broadcast("directiva:restaurarEslogan",{accion:false})}obtenerSVGFinal()});scope.$on("editor:planes",function(){$rootScope.$broadcast("directiva:planes",{svg:scope.svgFinal,colores:obtenerColores()})});scope.$on("editor:agregarEslogan",function(evento,datos){if(!element.find(".eslogan").length){var tamanoBase=100;var svgIcono;var svgTexto;var eslogan;var relacion=element[0].children[0].getClientRects()[0].height/tamanoBase;svgIcono=element.find("g.contenedor-icono > svg")[0];svgIcono.setAttribute("height",tamanoBase/2+"px");svgIcono.removeAttribute("width");svgIcono.removeAttribute("x");svgIcono.parentElement.setAttribute("transform","");svgTexto=element.find("text.textoPrincipal")[0];svgTexto.style.fontSize=tamanoBase/2+"px";svgTexto.setAttribute("text-anchor","middle");svgTexto.setAttribute("transform","");svgTexto.setAttribute("x",tamanoBase/2);while(svgTexto.getComputedTextLength()>1.6*svgIcono.height.baseVal.value){svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)-1+"px"}var paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);var paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText);if(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){while(svgTexto.getClientRects()[0].height/relacion+svgIcono.height.baseVal.value>=tamanoBase){svgIcono.setAttribute("height",parseFloat(svgIcono.getAttribute("height"))*.95+"px");svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px"}paddingTopIcono=(tamanoBase-(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion))/2;svgIcono.setAttribute("y",paddingTopIcono);paddingTopText=paddingTopIcono+parseFloat(svgIcono.getAttribute("height"))+svgTexto.getClientRects()[0].height/relacion/1.3+"px";svgTexto.setAttribute("y",paddingTopText)}var textoEslogan=document.createElementNS("http://www.w3.org/2000/svg","text");textoEslogan.setAttributeNS(null,"x",tamanoBase/2);textoEslogan.setAttributeNS(null,"y",tamanoBase*.9);var textoNodeEslogan=document.createTextNode(datos.eslogan);textoEslogan.appendChild(textoNodeEslogan);element.children()[0].appendChild(textoEslogan);var eslogan=element.children()[0].children[3];eslogan.setAttribute("text-anchor","middle");eslogan.setAttribute("font-family",datos.fuente.nombre);eslogan.setAttribute("class","eslogan");eslogan.setAttribute("transform","");eslogan.setAttribute("text-anchor","middle");eslogan.style.fontSize=svgTexto.style.fontSize;eslogan.setAttribute("x",tamanoBase/2);while(eslogan.getClientRects()[0].height/relacion*2.5>=svgTexto.getClientRects()[0].height/relacion){eslogan.style.fontSize=parseFloat(eslogan.style.fontSize)*.95+"px"}while(svgIcono.height.baseVal.value+svgTexto.getClientRects()[0].height/relacion+eslogan.getClientRects()[0].height/relacion*1.3>=tamanoBase){svgIcono.setAttribute("height",parseFloat(svgIcono.getAttribute("height"))*.95+"px");svgTexto.style.fontSize=parseFloat(svgTexto.style.fontSize)*.95+"px";eslogan.style.fontSize=parseFloat(eslogan.style.fontSize)*.95+"px"}var espacioSobrante=tamanoBase-(svgIcono.getClientRects()[0].height+svgTexto.getClientRects()[0].height+eslogan.getClientRects()[0].height)/relacion;svgIcono.setAttribute("y",espacioSobrante/2+"px");svgTexto.setAttribute("y",espacioSobrante/2+(svgIcono.getClientRects()[0].height+svgTexto.getClientRects()[0].height)/relacion+"px");eslogan.setAttribute("y",espacioSobrante/2+(svgIcono.getClientRects()[0].height+svgTexto.getClientRects()[0].height+eslogan.getClientRects()[0].height)/relacion+"px")}obtenerSVGFinal()});var obtenerSVGFinal=function(){var elemento=element.clone();elemento.find(".seleccionado").removeClass("seleccionado");scope.svgFinal=elemento.html()};var obtenerColores=function(){var parteSVG=null;var tamañoPivote=0;var color={icono:"",nombre:"",eslogan:""};element.find("g.contenedor-icono > svg [data-indice]:not(g)").each(function(){var elemento=angular.element(this)[0].getBoundingClientRect();var tamanoElemento=elemento.width*elemento.height;if(tamanoElemento>=tamañoPivote){tamañoPivote=tamanoElemento;parteSVG=angular.element(this)}});if(parteSVG.css("fill")){color.icono=parteSVG.css("fill")}else if(parteSVG.attr("fill")){color.icono=parteSVG.attr("fill")}else{color.icono="#fff"}color.nombre=element.find("text.textoPrincipal").css("fill");color.eslogan=element.find("text.eslogan").length?element.find("text.eslogan").css("fill"):"";return color}})}}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamScroll",[function(){return{restrict:"AE",link:function(scope,element){element.find("a.link-scroll").click(function(e){var irA=element.find(e.target.attributes.href.value);angular.element("body").animate({scrollTop:irA[0].offsetTop},1e3);return false})}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamRedireccionar",function($window,$location){return{restrict:"AE",link:function(){if($window.innerWidth<1024){$window.location="/m"+$location.url()}angular.element(window).resize(function(){if($window.innerWidth<1024){$window.location="/m"+$location.url()}})}}})},function(module,exports){angular.module("disenador-de-logos").directive("bazamPalettePicker",[function(){return{restrict:"AE",scope:true,templateUrl:"app/templates/bazamPalettePicker.tpl",controller:["$scope","coloresPaletteValue",function($scope,coloresPaletteValue){var bz=$scope.$parent.inicio;bz.palettes=coloresPaletteValue;if(bz.palettesCopy==undefined){bz.palettesCopy=[];angular.forEach(bz.palettes,function(palette,index){bz.palettesCopy.push([]);var i;for(i=0;i<palette.length;i++){bz.palettesCopy[index].push(false)}})}$scope.seleccionarColor=function($event){var indiceArrays;var pathSVG=$event.target;if(pathSVG.classList.contains("linea-1")){indiceArrays=0}else if(pathSVG.classList.contains("linea-2")){indiceArrays=1}else if(pathSVG.classList.contains("linea-3")){indiceArrays=2}else if(pathSVG.classList.contains("linea-4")){indiceArrays=3}var indicePalettes=parseInt(angular.element(pathSVG).data("index"))-1;var valor=bz.palettesCopy[indiceArrays][indicePalettes];bz.palettesCopy[indiceArrays][indicePalettes]=!valor;!valor?pathSVG.classList.add("color-checked"):pathSVG.classList.remove("color-checked")};$scope.checkRequired=function(){var requerir=true;angular.forEach(bz.palettesCopy,function(palettes){angular.forEach(palettes,function(palette){if(palette){requerir=false}})});return requerir}}],link:function(scope,element){element.find("[data-index]").each(function(index,el){var bz=scope.$parent.inicio;var indiceArrays;switch(el.className.baseVal){case"linea-1":indiceArrays=0;break;case"linea-2":indiceArrays=1;break;case"linea-3":indiceArrays=2;break;case"linea-4":indiceArrays=3}var indicePalettes=parseInt(angular.element(el).data("index"))-1;var valor=bz.palettesCopy[indiceArrays][indicePalettes];valor?el.classList.add("color-checked"):el.classList.remove("color-checked");el.style.fill=bz.palettes[indiceArrays][indicePalettes][0]})}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamMail",["clientesService","$q",function(clientesService,$q){return{require:"ngModel",link:function(scope,element,attributes,ctrl){ctrl.$asyncValidators.disponible=function(modelValor){var defered=$q.defer();var promise=defered.promise;if(ctrl.$isEmpty(modelValor)){return defered.resolve()}clientesService.correoDisponible(modelValor).then(function(){defered.resolve()}).catch(function(){defered.reject()});return promise}}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamFormLogin",[function(){return{restrict:"E",templateUrl:"app/templates/bazamFormLogin.tpl",controller:["$scope","clientesService","$mdToast","paisesValue","$rootScope","socialAuth","$state",function($scope,clientesService,$mdToast,paisesValue,$rootScope,socialAuth,$state){var bz=this;bz.vistaActual=$state.current.name;$rootScope.$on("$stateChangeSuccess",function(){bz.vistaActual=$state.current.name});bz.paisDefecto=null;bz.ingresar=true;clientesService.pais().then(function(res){bz.paisDefecto=res.iso});bz.datosLogin={};bz.completadoLogin=true;bz.login=function(datos,valido){if(valido&&bz.completadoLogin){bz.loginForm.falloLogin=false;bz.completadoLogin=false;clientesService.login(datos).then(function(){if(clientesService.autorizado(true)){$mdToast.show($mdToast.base({args:{mensaje:"¡Bienvenido!",clase:"success"}}));$rootScope.mostrarModalLogin=false;if($rootScope.callbackLogin){$rootScope.callbackLogin()}}}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Su usuario o contraseña son erroneos por favor verifique los mismos y vuelva a ingresar",clase:"danger"}}))}).finally(function(){bz.completadoLogin=true})}};bz.completadoRegistro=true;bz.registrar=function(datos,valido){if(valido&&bz.completadoRegistro){bz.registroForm.falloRegistro=false;bz.completadoRegistro=false;clientesService.registrar(datos.nombreCliente,datos.correo,datos.pass,datos.telefono,datos.pais).then(function(){if(clientesService.autorizado(true)){$mdToast.show($mdToast.base({args:{mensaje:"¡Registro exitoso!",clase:"success"}}));$rootScope.mostrarModalLogin=false;if($rootScope.callbackLogin){$rootScope.callbackLogin()}}}).catch(function(){bz.registroForm.falloRegistro=true}).finally(function(){bz.completadoRegistro=true})}};bz.olvido={tipo:"cliente"};bz.forgotPass=function(datos,v){if(v){bz.peticion=true;bz.loaderCargando2=true;clientesService.forgotPass(datos).then(function(){bz.rc=2;bz.loaderCargando2=false;$mdToast.show($mdToast.base({args:{mensaje:"Codigo enviado al correo.",clase:"success"}}))}).catch(function(){bz.loaderCargando=false}).finally(function(){bz.peticion=false})}};bz.confirmarToken=function(opcion,val){bz.peticion=true;if(opcion==true){if(val){clientesService.cambiarContrasena(bz.olvido).then(function(){bz.completadoLogin=true;var datos={correo:bz.olvido.correo,pass:bz.olvido.pass};bz.loaderCargando2=false;bz.login(datos,true)}).finally(function(){bz.peticion=false})}}else{clientesService.confirmarToken(bz.olvido.token).then(function(res){if(res){bz.rc=3;$mdToast.show($mdToast.base({args:{mensaje:"Codigo Confirmado.",clase:"success"}}))}}).catch(function(){}).finally(function(){bz.peticion=false})}};bz.social=function(op){switch(op){case"fb":socialAuth.facebook().then(function(res){if(clientesService.autorizado(true)){$mdToast.show($mdToast.base({args:{mensaje:"¡Bienvenido! "+res.data.msg,clase:"success"}}));$rootScope.mostrarModalLogin=false;if($rootScope.callbackLogin){$rootScope.callbackLogin()}}}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){});break;case"gg":socialAuth.google().then(function(res){if(clientesService.autorizado(true)){$mdToast.show($mdToast.base({args:{mensaje:"¡Bienvenido! "+res.data.msg,clase:"success"}}));$rootScope.mostrarModalLogin=false;if($rootScope.callbackLogin){$rootScope.callbackLogin()}}}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){});break}};bz.noLoguear=function(){$rootScope.mostrarModalLogin=false;$state.go("inicio")}}],controllerAs:"bazamLogin"}}]).directive("bazamModalLogin",[function(){return{restrict:"E",templateUrl:"app/templates/bazamModalLogin.tpl"}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamColorPicker",[function(){return{template:"<div class='bazam-color-picker'>\t\t\t\t\t\t\t<div class='background-selector' ng-style='jsonColor(color)' ng-click='mostrarPicker = !mostrarPicker'>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class='background-color-picker' id='background-color-picker' ng-show='mostrarPicker'>\t\t\t\t\t\t\t\t\t<div class='title'>\t\t\t\t\t\t\t\t\t\tFONDO\t\t\t\t\t\t\t\t\t\t<span class='close-color-picker' ng-click='mostrarPicker = !mostrarPicker'>\t\t\t\t\t\t\t\t\t\t\t<i class='material-icons cerrar'>clear</i>\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t<div ng-repeat='paletaColor in paletaColores track by $index' class='color' ng-style='jsonColor(paletaColor)' ng-click='$parent.color=paletaColor'></div>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>",scope:{color:"="},controller:["$scope","coloresPaletaValue",function($scope,coloresPaletaValue){$scope.paletaColores=coloresPaletaValue;$scope.jsonColor=function(color){return{"background-color":color}};$scope.mostrarPicker=false;$scope.$on("editor:cerrarColorPickers",function(){$scope.mostrarPicker=false});angular.element("#background-color-picker").draggable({revert:false})}]}}])},function(module,exports){angular.module("disenador-de-logos").directive("carouselMisLogos",[function(){return{restrict:"E",templateUrl:"app/templates/carousel-mis-logos.tpl",controller:["$scope","$base64","arrayToJsonMetasFactory","logosService","$mdToast","$location",function($scope,$base64,arrayToJsonMetasFactory,logosService,$mdToast,$location){var bz=this;bz.callback=$scope.callback;bz.elegido=$scope.elegido;bz.logos=$scope.logos;bz.base64=$base64;bz.actual=0;if($scope.logos.length){$scope.elegido=bz.base64.decode(bz.logos[bz.actual].logo)}if($scope.logos.length>1){bz.actual=1;$scope.actual=bz.actual;$scope.elegido=bz.base64.decode(bz.logos[bz.actual].logo)}bz.convertidor=arrayToJsonMetasFactory;bz.mover=function(accion){if(accion){bz.actual=bz.actual==bz.logos.length-1?0:bz.actual+1;$scope.actual=bz.actual;$scope.elegido=bz.base64.decode(bz.logos[bz.actual].logo)}else{bz.actual=bz.actual==0?bz.logos.length-1:bz.actual-1;$scope.actual=bz.actual;$scope.elegido=bz.base64.decode(bz.logos[bz.actual].logo)}};bz.borrarSlider=function(idLogo){bz.callback[4](idLogo).then(function(){bz.logos=$scope.logos;if(bz.logos.length&&bz.actual==bz.logos.length){bz.actual=bz.logos.length-1;$scope.elegido=bz.base64.decode(bz.logos[bz.actual].logo);$scope.actual=bz.actual}}).catch(function(){})};var dominio=$location.port()!="80"?$location.protocol()+"://"+$location.host()+":"+$location.port():$location.protocol()+"://"+$location.host();bz.completadoCompartir=true;bz.compartirPorEmail=function(email,logo,valido){if(valido&&bz.completadoCompartir){bz.completadoCompartir=false;logosService.enviarPorEmail(logo.idLogo,email,dominio).then(function(){$mdToast.show($mdToast.base({args:{mensaje:"Su logo ha sido enviado!",clase:"success"}}))}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){bz.completadoCompartir=true})}}}],controllerAs:"carouselMisLogos",scope:{callback:"<",logos:"<",elegido:"=",actual:"="}}}])},function(module,exports){angular.module("disenador-de-logos").directive("bazamAyuda",["$timeout","$compile",function($timeout,$compile){return{restrict:"A",controllerAs:"bazamAyuda",scope:{clases:"<",titulo:"@",texto:"@",retraso:"@",orientacion:"@",identificador:"@",indice:"@paso"},link:function(scope,element){if(!scope.clases){scope.clases=[]}if(!scope.retraso){scope.retraso=200}scope.$on("bazamAyuda:mostrar",function(evento,data){if(angular.element("#"+scope.identificador).length){return}var coordenadas=element[0].getClientRects()[0];var body=angular.element("body");var orientacion=scope.orientacion?scope.orientacion:"right";var orientacionFinal={top:0,left:0};if(scope.indice==data.indice){angular.element(".pop-ayuda").remove();var elementPOP=angular.element("<div></div>");elementPOP.addClass("pop-ayuda");elementPOP.append("<p class='titulo-ayuda'>"+scope.titulo+"</p>");elementPOP.append("<p class='texto-ayuda'>"+scope.texto+"</p>");elementPOP.attr("quitar-ayuda",parseInt(scope.indice));if(angular.element("[data-paso="+(parseInt(scope.indice)-1)+"]").length){var flechaIzq=angular.element("<div></div>");flechaIzq.addClass("flecha-ayuda izquierda");flechaIzq.attr("mostrar-pop-ayuda",parseInt(scope.indice)-1);flechaIzq.append("<span><i class='material-icons'>keyboard_arrow_left</i></span>");elementPOP.append(flechaIzq)}if(angular.element("[data-paso="+(parseInt(scope.indice)+1)+"]").length){var flechaDer=angular.element("<div></div>");flechaDer.addClass("flecha-ayuda derecha");flechaDer.attr("mostrar-pop-ayuda",parseInt(scope.indice)+1);flechaDer.append("<span><i class='material-icons'>keyboard_arrow_right</i></span>");elementPOP.append(flechaDer)}var html=$compile(elementPOP[0].outerHTML)(scope);var popCreado=angular.element(html);body.append(popCreado);angular.forEach(scope.clases,function(clase){popCreado.addClass(clase)});popCreado.css({position:"fixed","z-index":2,opacity:0});switch(orientacion){case"bottom":orientacionFinal.top=coordenadas.bottom;orientacionFinal.left=coordenadas.left+element.width()/2;break;case"right":orientacionFinal.top=coordenadas.top+element.height()/2;orientacionFinal.left=coordenadas.right;break;case"left":orientacionFinal.top=coordenadas.top+element.height()/2;orientacionFinal.left=coordenadas.left-popCreado.width();break;case"top":orientacionFinal.top=coordenadas.top;orientacionFinal.left=coordenadas.left+element.width()/2;break}popCreado.css({top:orientacionFinal.top,left:orientacionFinal.left});popCreado.attr({id:scope.identificador});if(scope.retraso){$timeout(function(){popCreado.addClass("aparecer")},scope.retraso)}}})}}}]).directive("bazamPasosAyuda",["$timeout","$compile",function($timeout,$compile){return{restrict:"A",controllerAs:"bazamPasosAyuda",link:function(scope,element,attrs){scope.$on("bazamPasoAyuda:mostrar",function(evento,accion){if(accion){var coordenadas=element[0].getClientRects()[0];var body=angular.element("body");var orientacion=attrs.orientacion?attrs.orientacion:"right";var orientacionFinal={top:0,left:0};var elementPOP=angular.element("<div></div>");elementPOP.attr("mostrar-pop-ayuda",attrs.paso);elementPOP.addClass("pop-paso-ayuda");elementPOP.append("<p class='paso-ayuda'>?</p>");var html=$compile(elementPOP[0].outerHTML)(scope);var popPasoCreado=angular.element(html);body.append(popPasoCreado);popPasoCreado.css({position:"fixed","z-index":2,opacity:0});switch(orientacion){case"bottom":orientacionFinal.top=coordenadas.bottom-40;orientacionFinal.left=coordenadas.left+element.width()/2;break;case"right":orientacionFinal.top=coordenadas.top+element.height()/2-10;orientacionFinal.left=coordenadas.right-35;break;case"left":orientacionFinal.top=coordenadas.top+element.height()/2-10;orientacionFinal.left=coordenadas.left-popPasoCreado.width()+25;break;case"top":orientacionFinal.top=coordenadas.top+40;orientacionFinal.left=coordenadas.left+element.width()/2;break}popPasoCreado.css({top:orientacionFinal.top,left:orientacionFinal.left});$timeout(function(){popPasoCreado.addClass("aparecer")},300)}else{angular.element(".pop-paso-ayuda").remove();angular.element(".pop-ayuda").remove()}})}}}]).directive("mostrarPopAyuda",["mostrarPopAyudaFactory",function(mostrarPopAyudaFactory){return{restrict:"AE",link:function(scope,element,attrs){element.click(function(){if(!angular.isUndefined(attrs.reiniciar)){angular.element("[mostrar-pop-ayuda]:not([mostrar-pop-ayuda=1])").remove()}if(!angular.element("#cerrar-ayudas").length){angular.element("body").append("<div><span>Cerrar Ayudas</span></div>")}mostrarPopAyudaFactory(attrs.mostrarPopAyuda)})}}}])},function(module,exports){angular.module("disenador-de-logos").controller("papeleriaEditorController",["papeleriaResolve","logoResolve","$base64","$scope","elementosService","fontService",function(papeleriaResolve,logoResolve,$base64,$scope,elementosService,fontService){var bz=this;bz.base64=$base64;bz.logo=logoResolve;bz.papeleria=papeleriaResolve;bz.fuentes=papeleriaResolve.fuentes;bz.datos={tipo:"",modelo:"",pieza:{caras:[],nombre:"",_id:"",logo:0}};bz.datos.pieza.logo=bz.logo.id;if(bz.papeleria.idPieza){bz.datos.pieza._id=bz.papeleria.idPieza}}])},function(module,exports){angular.module("disenador-de-logos").controller("papeleriaController",["$base64","$scope","$stateParams","$sce","logoResolve","$state","papeleriaService","$document","elementosService","fontService",function($base64,$scope,$stateParams,$sce,logoResolve,$state,papeleriaService,$document,elementosService,fontService){var bz=this;bz.base64=$base64;bz.sce=$sce;bz.idLogo=logoResolve.id;elementosService.listarFuentes().then(function(res){bz.fuentes=res;fontService.agregarGeneral(res)});papeleriaService.listarPorClienteYlogo(bz.idLogo).then(function(res){bz.papelerias=res;angular.forEach(bz.papelerias,function(papeleria){angular.forEach(papeleria.modelos,function(modelo){if(modelo.piezas){papeleria.tienePiezas=true;bz.tienePiezas=true}})});bz.papeleriaActiva=bz.papelerias[0].tipo});bz.enviarEditor=function(indicePapeleria,indiceModelo,indicePieza){if(bz.peticion)return;var papeleria=angular.copy(bz.papelerias[indicePapeleria]);delete papeleria.modelos;var modelo=angular.copy(bz.papelerias[indicePapeleria].modelos[indiceModelo]);delete modelo.piezas;var pieza=angular.copy(bz.papelerias[indicePapeleria].modelos[indiceModelo].piezas[indicePieza]);bz.datos={papeleria:papeleria,modelo:modelo,pieza:pieza,fuentes:bz.fuentes};$state.go("papeleriaEditor",{id:bz.idLogo,papeleria:bz.datos})};bz.descargarPieza=function(id){angular.element(document.querySelector(".overlay.full")).fadeIn(1e3);papeleriaService.piezas.descargar(id,bz.idLogo).then(function(res){var a=$document[0].createElement("a");$document[0].body.appendChild(a);a.style="display:none";var url=res.url;a.href=url;a.download=res.nombreArchivo;a.target="_blank";a.click();a.remove()}).finally(function(){angular.element(document.querySelector(".overlay.full")).fadeOut(1e3)})};bz.duplicarPieza=function(tipo,modelo,pieza){if(bz.peticion)return;bz.peticion=true;papeleriaService.piezas.guardar(tipo,modelo.nombre,piezaNueva).then(function(res){modelo.piezas.push(res)}).finally(function(){bz.peticion=false})};bz.eliminarPieza=function(arr,pieza,index){if(bz.peticion)return;bz.peticion=true;papeleriaService.piezas.eliminar(pieza._id).then(function(res){arr.splice(index,1)}).finally(function(){bz.peticion=false})}}])},function(module,exports){angular.module("disenador-de-logos").controller("pagoCompletoController",["arrayToJsonMetasFactory","$scope","$state","logosService","$stateParams","$base64",function(arrayToJsonMetasFactory,$scope,$state,logosService,$stateParams,$base64){var bz=this;bz.base64=$base64;bz.logo=false;bz.calificacionTentativa=5;bz.atributos={padre:null,calificacion:null};bz.padre=null;logosService.obtenerPorId($stateParams.id).then(function(res){bz.logo=res;var atributos=arrayToJsonMetasFactory(bz.logo.atributos);if(atributos.padre){bz.atributos.padre=true;bz.padre=parseInt(atributos.padre);logosService.obtenerPorId(bz.padre).then(function(res){var atributosPadre=arrayToJsonMetasFactory(res.atributos);if(atributosPadre["calificacion-cliente"]){bz.atributos.calificacion=true}else{bz.atributos.calificacion=false}}).catch(function(res){}).finally(function(){})}}).catch(function(res){}).finally(function(){});bz.completado=true;bz.calificar=function(calificacion,comentario,valido){if(valido&&bz.completado){bz.completado=false;logosService.calificar(bz.padre,calificacion,comentario).finally(function(){bz.completado=true;bz.atributos.calificacion=true})}};$scope.$on("sesionExpiro",function(event,data){$state.go("inicio")})}])},function(module,exports){angular.module("disenador-de-logos").controller("pagoController",["$scope","historicoResolve","pedidosService","$window","$state","$base64",function($scope,historicoResolve,pedidosService,$window,$state,$base64){var bz=this;bz.base64=$base64;bz.pedido=historicoResolve;bz.pasarelas=[];pedidosService.listarPasarelas(bz.pedido.precio.moneda.idMoneda).then(function(res){bz.pasarelas=res;bz.pasarelaElegida=bz.pasarelas[1]});bz.terminos=true;bz.mostrarMetodo=function(indice,terminos){if(!terminos){return}angular.forEach(bz.pasarelas,function(pasarela,llave){if(pasarela.idPasarela!=indice){bz.pasarelas[llave].mostrar=false}else{bz.pasarelas[llave].mostrar=true}})};bz.completado=true;bz.pagar=function(idPasarela,terminos){if(terminos&&bz.completado){bz.completado=false;angular.element(document.querySelector(".overlay.full")).fadeIn(1e3);switch(idPasarela){case 1:pedidosService.pagar.paypal(bz.pedido.idElemento,bz.pedido.atributos,bz.base64.encode(bz.pedido.logo),bz.pedido.precio.idPrecio,bz.pedido.tipo,idPasarela).then(function(res){$window.location=res}).finally(function(){bz.completado=true});break;case 2:break;case 3:break;default:break}}};$scope.$on("sesionExpiro",function(){$state.go("inicio")})}])},function(module,exports){angular.module("disenador-de-logos").controller("logosGaleriaController",["$scope","$state","$base64","logosService","clientesService","$mdToast","$timeout",function($scope,$state,$base64,logosService,clientesService,$mdToast,$timeout){var bz=this;bz.base64=$base64;bz.aprobados=[];logosService.mostrarDestacados().then(function(res){bz.aprobados=res}).catch(function(){}).finally(function(){if(!bz.aprobados.length){logosService.mostrarAprobados().then(function(res){bz.aprobados=res}).catch(function(res){}).finally(function(){})}});bz.completadoCarga=true;bz.cargarMas=function(logo){if(bz.completadoCarga){bz.completadoCarga=false;var idLogo=logo.destacados?false:logo.idLogo;logosService.mostrarAprobados(idLogo).then(function(res){angular.forEach(res,function(valor,llave){bz.aprobados.push(valor)})}).catch(function(){}).finally(function(){bz.completadoCarga=true})}};bz.buscarAtributo=function(lista,objetivo){var idFuente=null;angular.forEach(lista,function(atributo,llave){if(atributo.clave==objetivo){idFuente=atributo.valor}});return idFuente};bz.avanzar=function(indiceLogo){bz.logoSeleccionado=indiceLogo;if(!clientesService.autorizado()){bz.mostrarModalLogin=true}else{var aprobado=null;angular.forEach(bz.aprobados,function(valor,llave){if(valor.idLogo==indiceLogo){aprobado=valor}});if(aprobado){$state.go("editor",{status:true,datos:{logo:{icono:{idElemento:aprobado.elementos_idElemento,svg:aprobado.logo}},idLogoPadre:aprobado.idLogo,fuentes:{principal:bz.buscarAtributo(aprobado.atributos,"principal"),eslogan:bz.buscarAtributo(aprobado.atributos,"eslogan")}}})}}};bz.datosLogin={};bz.completadoLogin=true;bz.login=function(datos,valido){if(valido){bz.completadoLogin=false;clientesService.login(datos).then(function(res){if(clientesService.autorizado(true)){$mdToast.show({hideDelay:0,position:"top right",controller:["$scope","$mdToast",function($scope,$mdToast){var temporizador=$timeout(function(){$mdToast.hide()},2e3);$scope.closeToast=function(){$timeout.cancel(temporizador);$mdToast.hide()}}],templateUrl:"toast-success-login.html"});bz.mostrarModalLogin=false;bz.avanzar(bz.logoSeleccionado)}}).catch(function(){$mdToast.show({hideDelay:0,position:"top right",controller:["$scope","$mdToast",function($scope,$mdToast){var temporizador=$timeout(function(){$mdToast.hide()},2e3);$scope.closeToast=function(){$timeout.cancel(temporizador);$mdToast.hide()}}],templateUrl:"toast-danger-login.html"})}).finally(function(res){bz.completadoLogin=true})}};bz.completadoRegistro=true;bz.registrar=function(datos,valido){if(valido&&bz.completadoRegistro){bz.completadoRegistro=false;clientesService.registrar(datos.nombreCliente,datos.correo,datos.pass,datos.telefono,datos.pais).then(function(res){if(clientesService.autorizado(true)){$mdToast.show({hideDelay:0,position:"top right",controller:["$scope","$mdToast",function($scope,$mdToast){var temporizador=$timeout(function(){$mdToast.hide()},2e3);$scope.closeToast=function(){$timeout.cancel(temporizador);$mdToast.hide()}}],templateUrl:"toast-success-registro.html"});bz.mostrarModalLogin=false;bz.avanzar(bz.logoSeleccionado)}}).catch(function(){$mdToast.show({hideDelay:0,position:"top right",controller:["$scope","$mdToast",function($scope,$mdToast){var temporizador=$timeout(function(){$mdToast.hide()},2e3);$scope.closeToast=function(){$timeout.cancel(temporizador);$mdToast.hide()}}],templateUrl:"toast-danger-registro.html"})}).finally(function(){bz.completadoRegistro=true})}}}])},function(module,exports){angular.module("disenador-de-logos").controller("logosController",["$scope","pedidosService","$window","$state","logosService","$base64","$mdToast","arrayToJsonMetasFactory","$location","Socialshare","$q",function($scope,pedidosService,$window,$state,logosService,$base64,$mdToast,arrayToJsonMetasFactory,$location,Socialshare,$q){var bz=this;bz.base64=$base64;bz.opcionMostrar="guardados";bz.guardados=[];bz.comprados=[];bz.elegido=null;bz.salto={comprados:0,guardados:0};bz.cantidad={comprados:0,guardados:0};bz.terminados={comprados:false,guardados:false};bz.actual=1;$scope.$watch("logos.actual",function(newValue,oldValue){if(newValue===oldValue){return}bz.mostrarPlanes(newValue,true)});logosService.mostrarGuardados().then(function(res){bz.guardados=res;bz.cantidad.guardados=bz.guardados.length;bz.mostrarPlanes(bz.actual,true)}).catch(function(){}).finally(function(){bz.terminados.guardados=true});logosService.mostrarComprados().then(function(res){bz.comprados=res;bz.cantidad.comprados=bz.comprados.length}).catch(function(){}).finally(function(){bz.terminados.comprados=true});bz.modificarSalto=function(accion,objetivo){if(accion){if(bz[objetivo][bz.salto[objetivo]+9]){bz.salto[objetivo]=bz.salto[objetivo]+9}}else if(bz.salto[objetivo]-9>=0){bz.salto[objetivo]=bz.salto[objetivo]-9}};bz.urlCompartir=$location.port()!="80"?$location.protocol()+"://"+$location.host()+":"+$location.port():$location.protocol()+"://"+$location.host();bz.mostrarModalSocial=false;bz.idLogoCompartir=null;bz.abrirModal=function(idLogo){bz.mostrarModalSocial=true;bz.idLogoCompartir=idLogo};bz.borradoCompleto=true;bz.borrarLogo=function(idLogo){if(bz.borradoCompleto){var defered=$q.defer();var promise=defered.promise;bz.borradoCompleto=false;logosService.borrarLogo(idLogo).then(function(){angular.forEach(bz.guardados,function(valor,indice){if(valor.idLogo==idLogo){bz.guardados.splice(indice,1);return false}});defered.resolve(true);$mdToast.show($mdToast.base({args:{mensaje:"El logo fue borrado exitosamente!",clase:"success"}}))}).catch(function(){defered.reject();$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){bz.borradoCompleto=true});return promise}};bz.buscarAtributo=function(lista,objetivo){var valor=null;angular.forEach(lista,function(atributo){if(atributo.clave==objetivo){valor=atributo.valor}});return valor};bz.mostrarPlanes=function(index,previsualizar){var datos=angular.copy(bz.guardados[index]);datos.atributos=arrayToJsonMetasFactory(datos.atributos);bz.datosComprar={idLogo:datos.idLogo,logo:bz.base64.decode(datos.logo),idElemento:datos.elementos_idElemento,tipo:"Logo y nombre",fuentes:{principal:datos.atributos.principal,eslogan:datos.atributos.principal.eslogan},colores:{icono:datos.atributos["color-icono"],nombre:datos.atributos["color-nombre"]},planes:bz.planes,moneda:bz.moneda};if(datos.atributos["color-eslogan"]){bz.datosComprar.colores.eslogan=datos.atributos["color-eslogan"]}if(previsualizar){return}bz.abrirPlanes=true};$scope.$on("sesionExpiro",function(){$state.go("inicio")});bz.compartir=function(provider,idLogo){var unix=Date.now();var attrs={socialshareUrl:bz.urlCompartir+"?idLogo="+idLogo+"&unix="+unix};switch(provider){case"twitter":attrs.socialshareHashtags="Liderlogo";break;case"pinterest":attrs.socialshareMedia=bz.urlCompartir+"/app/logo/compartido/"+idLogo;attrs.socialshareText="Pinterest";break}Socialshare.share({provider:provider,attrs:attrs})}}])},function(module,exports){angular.module("disenador-de-logos").controller("loginController",["$state","$rootScope",function($state,$rootScope){$rootScope.callbackLogin=function(){$state.go("logos")}}])},function(module,exports){angular.module("disenador-de-logos").controller("inicioController",["categoriasService","preferenciasService","elementosService","$stateParams","$q","$scope","$state","crearLogoFactory","clientesService","$mdToast","$timeout","logosService","$base64","coloresFactory","landingResolve","coloresPaletteValue","etiquetasService","pedidosService","$rootScope","$location","Socialshare",function(categoriasService,preferenciasService,elementosService,$stateParams,$q,$scope,$state,crearLogoFactory,clientesService,$mdToast,$timeout,logosService,$base64,coloresFactory,landingResolve,coloresPaletteValue,etiquetasService,pedidosService,$rootScope,$location,Socialshare){var bz=this;bz.base64=$base64;bz.obtenerColores=function(coloresArray){return coloresFactory(angular.copy(coloresArray))};bz.colorRandom=function(largoArray){var i=Math.floor(Math.random()*largoArray)+0;return i};bz.palettes=coloresPaletteValue;if(landingResolve){bz.palettesCopy=landingResolve.palettesCopy}bz.datos=landingResolve?landingResolve.datos:{nombre:"Mi logo",preferencias:[],categoria:{icono:"",fuente:""},etiquetasSeleccionadas:[]};bz.urlCompartir=$location.port()!="80"?$location.protocol()+"://"+$location.host()+":"+$location.port():$location.protocol()+"://"+$location.host();bz.completadoCompartirSocial=true;bz.compartir=function(provider,logo){if(!clientesService.autorizado()){$rootScope.mostrarModalLogin=true;$rootScope.callbackLogin=false;return}if(bz.completadoCompartirSocial){bz.completadoCompartirSocial=false;var defered=$q.defer();var compartirPromise=defered.promise;if(!logo.idLogo){bz.guardarLogo(logo.cargado,"Logo y nombre",logo.icono.idElemento,logo.fuente.idElemento).then(function(res){logo.idLogo=res;var unix=Date.now();var attrs={socialshareUrl:bz.urlCompartir+$location.path()+"?idLogo="+logo.idLogo+"&unix="+unix};switch(provider){case"twitter":attrs.socialshareHashtags="Liderlogo";break;case"pinterest":attrs.socialshareMedia=bz.urlCompartir+"/app/logo/compartido/"+logo.idLogo;attrs.socialshareText="Pinterest";break}Socialshare.share({provider:provider,attrs:attrs})}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){defered.resolve()})}else{var unix=Date.now();var attrs={socialshareUrl:bz.urlCompartir+$location.path()+"?idLogo="+logo.idLogo+"&unix="+unix};switch(provider){case"twitter":attrs.socialshareHashtags="Liderlogo";break;case"pinterest":attrs.socialshareMedia=bz.urlCompartir+"/app/logo/compartido/"+logo.idLogo;attrs.socialshareText="Pinterest";break}Socialshare.share({provider:provider,attrs:attrs});defered.resolve()}compartirPromise.finally(function(){bz.completadoCompartirSocial=true})}};bz.compartirPorEmailUrl=function(){var datosFormat=angular.copy(bz.datos);angular.forEach(datosFormat.etiquetasSeleccionadas,function(valor){if(valor.$$hashKey){delete valor.$$hashKey}});delete datosFormat.fuentes;delete datosFormat.colores;var datos={datos:datosFormat,palettesCopy:bz.palettesCopy,logoCompartido:true};var url=bz.urlCompartir+$location.path()+"?datos="+encodeURI(angular.toJson(datos));return url};categoriasService.listaCategorias("FUENTE").then(function(res){bz.datos.fuentes=res}).catch(function(){});bz.coloresIguales=function(color){var coincidencia;angular.forEach(bz.datos.colores,function(datosColor){if(angular.equals(color,datosColor)){coincidencia=true}});return coincidencia};bz.jqueryScrollbarOptions={};bz.iconos=[];bz.fuentes=[];bz.logos=[];bz.aprobados=[];bz.logoSeleccionado=null;bz.logoElegido=null;bz.predisenadoSeleccionado=null;bz.objetivoEditor=null;bz.categoriasPosibles={fuentes:[],iconos:[]};bz.preferencias=[];categoriasService.listaCategorias("ICONO").then(function(res){bz.categoriasPosibles.iconos=res}).catch(function(){});categoriasService.listaCategorias("FUENTE").then(function(res){bz.categoriasPosibles.fuentes=res}).catch(function(){});bz.combinar=function(iconos,fuentes){bz.datos.colores=[];angular.forEach(bz.palettesCopy,function(palettes,indicePalettes){angular.forEach(palettes,function(palette,indicePalette){if(palette){bz.datos.colores.push(bz.palettes[indicePalettes][indicePalette])}})});var logos=crearLogoFactory(iconos,fuentes);bz.logos=logos};bz.completado=true;if(landingResolve&&!landingResolve.logoCompartido){bz.combinar(landingResolve.iconos,landingResolve.fuentes)}bz.solicitarElementos=function(inicial){if(bz.completado){if(bz.datosForm&&!bz.datosForm.$valid&&!landingResolve.logoCompartido)return;bz.completado=false;var tags=[];angular.forEach(bz.datos.etiquetasSeleccionadas,function(tag){tags.push(tag.traduccion.valor)});var promesaIconos=inicial?elementosService.listarIniciales(inicial):elementosService.listarIconosSegunTags(tags,bz.datos.categoria.icono,bz.iconos,12);var promesaFuentes=elementosService.listaFuentesSegunPref(bz.datos.categoria.fuente,bz.datos.preferencias,12);$q.all([promesaIconos,promesaFuentes]).then(function(res){angular.forEach(res[0],function(icono){bz.iconos.push(icono.idElemento)});bz.combinar(res[0],res[1])}).catch(function(){}).finally(function(){bz.completado=true})}};if(landingResolve&&landingResolve.logoCompartido){bz.solicitarElementos()}bz.preAvanzar=function(logo){bz.logoSeleccionado=bz.logos.indexOf(logo);bz.avanzar()};bz.avanzar=function(){var logoSeleccionado=angular.copy(bz.logos[bz.logoSeleccionado]);if(logoSeleccionado.idLogo){logoSeleccionado.icono.svg=bz.base64.encode(logoSeleccionado.cargado)}var datos={status:true,datos:{logo:logoSeleccionado,texto:bz.datos.nombre,categoria:logoSeleccionado.icono.categorias_idCategoria,colores:[logoSeleccionado.colores[0],logoSeleccionado.colores[logoSeleccionado.random]]}};$state.go("editor",datos)};bz.comprarLogo=function(svg,colores,logo,idLogo,v){bz.datosComprar={logo:svg,idLogo:idLogo,idElemento:logo.icono.idElemento,tipo:"Logo y nombre",fuentes:{principal:logo.fuente.idElemento},colores:{fondo:colores[1],icono:colores[0],nombre:colores[0]},planes:bz.planes,moneda:bz.moneda};if(v){return bz.verPrevisualizar=true}bz.abrirPlanes=true};bz.preGuardarLogo=function(logo){if(logo.idLogo){return}if(!clientesService.autorizado()){$rootScope.mostrarModalLogin=true;$rootScope.callbackLogin=false;return}bz.guardarLogo(logo.cargado,"Logo y nombre",logo.icono.idElemento,logo.fuente.idElemento).then(function(res){var indiceLogo=bz.logos.indexOf(logo);bz.logos[indiceLogo].idLogo=res;$mdToast.show($mdToast.base({args:{mensaje:"Su logo ha sido guardado con exito!",clase:"success"}}))}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))})};bz.completadoGuardar=true;bz.guardarLogo=function(logo,tipoLogo,idElemento,idFuentePrincipal){var defered=$q.defer();var promise=defered.promise;if(bz.completadoGuardar){bz.completadoGuardar=false;logosService.guardarLogo(bz.base64.encode(logo),tipoLogo,idElemento,idFuentePrincipal).then(function(res){defered.resolve(res)}).catch(function(res){defered.reject(res)}).finally(function(){bz.completadoGuardar=true})}return promise};bz.completadoCompartir=true;bz.compartirPorEmail=function(email,logo,valido){if(!clientesService.autorizado()){$rootScope.mostrarModalLogin=true;$rootScope.callbackLogin=false;return}if(valido&&bz.completadoCompartir){bz.completadoCompartir=false;var defered=$q.defer();var emailPromise=defered.promise;if(!logo.idLogo){bz.guardarLogo(logo.cargado,"Logo y nombre",logo.icono.idElemento,logo.fuente.idElemento).then(function(res){logo.idLogo=res;var url=bz.compartirPorEmailUrl();logosService.enviarPorEmail(logo.idLogo,email,url).then(function(){$mdToast.show($mdToast.base({args:{mensaje:"Su logo ha sido enviado!",clase:"success"}}))}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){defered.resolve()})}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}));defered.resolve()})}else{var url=bz.compartirPorEmailUrl();logosService.enviarPorEmail(logo.idLogo,email,url).then(function(){$mdToast.show($mdToast.base({args:{mensaje:"Su logo ha sido enviado!",clase:"success"}}))}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){defered.resolve()})}emailPromise.finally(function(){bz.completadoCompartir=true})}};bz.selectedItem=null;bz.searchText=null;bz.etiquetasFunciones=etiquetasService;etiquetasService.listarEtiquetas().then(function(res){bz.etiquetas=etiquetasService.loadEtiquetas(res.data)}).catch(function(){})}])},function(module,exports){angular.module("disenador-de-logos").controller("headerController",["$state","clientesService","$rootScope","$scope","mostrarPasoPopAyudaFactory","verificarBase64Factory",function($state,clientesService,$rootScope,$scope,mostrarPasoPopAyudaFactory,verificarBase64Factory){var bz=this;bz.salir=function(){clientesService.salir(true,true)};bz.verificarBase64=verificarBase64Factory;bz.autorizado=clientesService.autorizado();bz.mostrarPasoPopAyuda=mostrarPasoPopAyudaFactory;$scope.$on("sesionExpiro",function(){bz.autorizado=clientesService.autorizado()});$scope.$on("sesionInicio",function(){bz.autorizado=clientesService.autorizado()})}])},function(module,exports){angular.module("disenador-de-logos").controller("editorController",["$scope","$stateParams","$state","$base64","categoriasService","logosService","clientesService","historicoResolve","$rootScope","$mdToast","elementosService","coloresFactory","$q","$window","pedidosService","fontService","etiquetasService",function($scope,$stateParams,$state,$base64,categoriasService,logosService,clientesService,historicoResolve,$rootScope,$mdToast,elementosService,coloresFactory,$q,$window,pedidosService,fontService,etiquetasService){var bz=this;bz.base64=$base64;bz.cuadricula=false;bz.contenedores={busquedaIconos:false,borradores:false,fuentes:false};bz.colorFondo=historicoResolve.colores?historicoResolve.colores[1]:"rgb(243, 243, 243)";bz.colorFondoAnterior=bz.colorFondo;bz.colorTexto=historicoResolve.colores?historicoResolve.colores[0]:"#000";bz.colorEslogan="#000";bz.colorIcono=historicoResolve.colores?historicoResolve.colores[0]:"#000";bz.svgFinal="";bz.jqueryScrollbarOptions={};bz.logo=historicoResolve.logo;if(!historicoResolve.idLogoGuardado&&!historicoResolve.idLogoPadre){bz.logo.texto=historicoResolve.texto;bz.categoria=historicoResolve.logo.icono.categorias_idCategoria}else if(historicoResolve.idLogoGuardado){bz.logo.idLogo=historicoResolve.idLogoGuardado}else if(historicoResolve.idLogoPadre){bz.idLogoPadre=historicoResolve.idLogoPadre}bz.categoriasPosibles=[];categoriasService.listaCategorias("ICONO").then(function(res){angular.forEach(res,function(valor){bz.categoriasPosibles.push(valor)})});categoriasService.listaCategorias("FUENTE").then(function(res){bz.fuentesCategorias=res}).catch(function(){});elementosService.listarFuentes().then(function(res){bz.fuentes=res;fontService.agregarGeneral(bz.fuentes);if(historicoResolve.idLogoGuardado||historicoResolve.idLogoPadre){angular.forEach(bz.fuentes,function(valor){if(valor.idElemento==historicoResolve.fuentes.principal){bz.logo.fuente={url:valor.url,nombre:valor.nombre}}if(valor.idElemento==historicoResolve.fuentes.eslogan){bz.logo.fuenteEslogan={url:valor.url,nombre:valor.nombre};bz.esloganActivo=true}})}});bz.preGuardarLogo=function(logo,tipoLogo,idElemento,idFuentePrincipal,regresar){if(!clientesService.autorizado()){$rootScope.mostrarModalLogin=true;$rootScope.callback=false;return}bz.guardarLogo(logo,tipoLogo,idElemento,regresar)};bz.completadoGuardar=true;bz.guardarLogo=function(logo,tipoLogo,idElemento,idFuentePrincipal,regresar){var defered=$q.defer();var promise=defered.promise;if(bz.completadoGuardar){bz.completadoGuardar=false;var fuentesId={principal:null,eslogan:null};angular.forEach(bz.fuentes,function(fuente){if(bz.logo.fuente&&bz.logo.fuente.url==fuente.url){fuentesId.principal=fuente.idElemento}if(bz.logo.fuenteEslogan&&bz.logo.fuenteEslogan.url==fuente.url){fuentesId.eslogan=fuente.idElemento}});if(!bz.logo.idLogo){logosService.guardarLogo(bz.base64.encode(logo),tipoLogo,idElemento,fuentesId.principal,fuentesId.eslogan,bz.idLogoPadre).then(function(res){bz.logo.idLogo=res;if(!regresar){$mdToast.show($mdToast.base({args:{mensaje:"Su logo ha sido guardado con exito!",clase:"success"}}))}else{defered.resolve(res)}}).catch(function(res){if(!regresar){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}else{defered.reject(res)}}).finally(function(){bz.completadoGuardar=true})}else{logosService.modificarLogo(bz.base64.encode(logo),bz.logo.idLogo,fuentesId.principal,fuentesId.eslogan).then(function(res){if(!regresar){$mdToast.show($mdToast.base({args:{mensaje:"Su logo ha sido guardado con exito!",clase:"success"}}))}else{return defered.resolve(res)}}).catch(function(res){if(!regresar){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}else{defered.reject(res)}}).finally(function(){bz.completadoGuardar=true})}}return promise};bz.activarCuadricula=function(){bz.cuadricula=!bz.cuadricula;if(bz.cuadricula){bz.colorFondoAnterior=bz.colorFondo;bz.colorFondo="transparent"}else{bz.colorFondo=bz.colorFondoAnterior}};bz.buscarPlanes=function(){$rootScope.$broadcast("editor:planes",true)};$scope.$on("directiva:planes",function(evento,datos){var idFuente=null;var idFuenteEslogan=null;angular.forEach(bz.fuentes,function(valor){if(valor.url==bz.logo.fuente.url){idFuente=valor.idElemento}if(bz.logo.fuenteEslogan&&valor.url==bz.logo.fuenteEslogan.url){idFuenteEslogan=valor.idElemento}});bz.datosComprar={logo:datos.svg,idLogo:null,idElemento:bz.logo.icono.idElemento,tipo:"Logo y nombre",fuentes:{principal:idFuente,eslogan:idFuenteEslogan},colores:datos.colores,planes:bz.planes,moneda:bz.moneda,editor:true};if(bz.idLogoPadre){bz.datosComprar.idPadre=bz.idLogoPadre}if(bz.logo.idLogo){bz.datosComprar.idLogo=bz.logo.idLogo}bz.abrirPlanes=true});bz.cambioColor=function(color,objetivo){$rootScope.$broadcast("editor:color",{color:color,objetivo:objetivo})};bz.cambioTexto=function(texto,eslogan){$rootScope.$broadcast("editor:texto",{texto:texto,eslogan:eslogan})};bz.verificarEslogan=function(eslogan){if(eslogan===""){bz.esloganActivo=false;bz.logo.fuenteEslogan=null;$rootScope.$broadcast("editor:eliminarEslogan")}};bz.quitarEsloganDefault=function(eslogan){if(eslogan==="Mi eslogan aquí"){bz.logo.eslogan="";bz.cambioTexto("",true)}};bz.cambioFuente=function(fuente,objetivo){$rootScope.$broadcast("editor:fuente",{fuente:angular.copy(fuente),objetivo:objetivo})};bz.cambioPropiedad=function(propiedad,eslogan){$rootScope.$broadcast("editor:propiedad",{propiedad:propiedad,eslogan:eslogan})};bz.cambioTamano=function(objetivo,accion){$rootScope.$broadcast("editor:tamano",{objetivo:objetivo,accion:accion})};bz.comparaciones=[];bz.realizarComparacion=function(){$rootScope.$broadcast("editor:comparar",true)};$scope.$on("directiva:comparar",function(evento,valor){if(bz.comparaciones.length<=10){bz.comparaciones.push(valor)}});bz.removerComparacion=function(comparacion){var indice=bz.comparaciones.indexOf(comparacion);bz.comparaciones.splice(indice,1)};bz.cambiarOrientacion=function(orientacion){$rootScope.$broadcast("editor:orientacion",orientacion)};bz.iconos=[];bz.completadoBuscar=true;bz.selectedItem=null;bz.searchText=null;bz.etiquetasFunciones=etiquetasService;etiquetasService.listarEtiquetas().then(function(res){bz.etiquetas=etiquetasService.loadEtiquetas(res.data)}).catch(function(){});bz.etiquetasSeleccionadas=[];bz.buscarIconos=function(idCategoria,valido){bz.iconosForm.$setSubmitted();if(valido&&bz.completadoBuscar){bz.completadoBuscar=false;var tags=[];var iconos=[];angular.forEach(bz.etiquetasSeleccionadas,function(valor){tags.push(valor.traduccion.valor)});if(bz.iconos.length>0){angular.forEach(bz.iconos,function(valor){iconos.push(valor.idElemento)})}bz.cerrarContenedores();bz.contenedores.busquedaIconos=true;elementosService.listarIconosSegunTags(tags,idCategoria,iconos,17).then(function(res){bz.iconos=[];bz.iconos=res}).catch(function(res){console.log(res)}).finally(function(){bz.completadoBuscar=true})}};bz.reemplazarIcono=function(icono){bz.logo.icono=icono;$rootScope.$broadcast("editor:reemplazar",bz.base64.decode(icono.svg))};$scope.$on("directiva:restaurarEslogan",function(evento,datos){if(datos.accion){var fuenteElegida=null;angular.forEach(bz.fuentes,function(valor){if(valor.nombre==datos.fuente.nombre){fuenteElegida={nombre:valor.nombre,url:valor.url}}});bz.logo.fuenteEslogan=fuenteElegida;bz.esloganActivo=true}else{bz.logo.eslogan="";bz.logo.fuenteEslogan=null;bz.esloganActivo=false}});bz.agregarEslogan=function(){bz.logo.eslogan="Mi eslogan aquí";bz.logo.fuenteEslogan=bz.logo.fuente;$rootScope.$broadcast("editor:agregarEslogan",{eslogan:bz.logo.eslogan,fuente:bz.logo.fuenteEslogan});bz.esloganActivo=true};bz.restaurarComparacion=function(comparacion){$rootScope.$broadcast("editor:restaurar",comparacion)};bz.monedas={};bz.moneda={};bz.monedaDefault={};bz.planes=[];bz.impuesto=0;pedidosService.listarPlanes().then(function(res){bz.monedaDefault={simbolo:res.monedaDefault.codigo,idMoneda:res.monedaDefault.idMoneda};bz.impuesto=res.impuesto;bz.planes=res.planes;angular.forEach(res.planes,function(plan){angular.forEach(plan.precios,function(precio){if(!bz.monedas[precio.moneda]){bz.monedas[precio.moneda]={simbolo:precio.moneda,idMoneda:precio.idMoneda}}})});bz.moneda=bz.monedaDefault});bz.precioSeleccionado=function(precios){var precioFinal="";angular.forEach(precios,function(valor){if(valor.moneda==bz.moneda.simbolo){precioFinal=valor.moneda+" "+valor.precio}});return precioFinal};bz.abrirContenedor=function(contenedor,noCerrar){if(!noCerrar&&bz.contenedores[contenedor])return bz.contenedores[contenedor]=false;bz.cerrarContenedores(contenedor);bz.contenedores[contenedor]=true};bz.cerrarContenedores=function(contenedor){$scope.$broadcast("editor:cerrarColorPickers",true);angular.forEach(bz.contenedores,function(el,k){if(contenedor==k)return;bz.contenedores[k]=false})}}])},function(module,exports){angular.module("disenador-de-logos").controller("descargarController",["logoResolve","logosService","$state","$scope","$base64","$filter","planesService","pedidosService","$window","$document",function(logoResolve,logosService,$state,$scope,$base64,$filter,planesService,pedidosService,$window,$document){var bz=this;bz.base64=$base64;bz.formatosNoSociales=[{nombre:"editable",ancho:400},{nombre:"papeleria",ancho:300},{nombre:"documento",ancho:300,plantilla:{tipo:"ppt",nombre:"eglamour"}}];bz.formatos=[{nombre:"facebook",ancho:180},{nombre:"whatsapp",ancho:300},{nombre:"instagram",ancho:110},{nombre:"google-plus",ancho:250},{nombre:"youtube",ancho:200},{nombre:"twitter",ancho:400},{nombre:"linkedin",ancho:400},{nombre:"pinterest",ancho:60},{nombre:"telegram",ancho:300},{nombre:"vimeo",ancho:300}];bz.logo=logoResolve;bz.plan={};bz.planes={};bz.monedas={};bz.moneda={};bz.mostrarAumento=false;planesService.porLogo(bz.logo.id).then(function(res){bz.plan=res.caracteristicas;bz.idPlan=res.idPlan;planesService.aumentarPlan(bz.idPlan).then(function(res){if(res.planes.superiores.length){bz.moneda={simbolo:res.monedaDefault.codigo,idMoneda:res.monedaDefault.idMoneda};bz.mostrarAumento=true;bz.planes=res.planes.superiores;angular.forEach(res.planes.superiores,function(plan){angular.forEach(plan.precios,function(precio){if(!bz.monedas[precio.moneda]){bz.monedas[precio.moneda]={simbolo:precio.moneda,idMoneda:precio.idMoneda}}})});bz.mps=true;pedidosService.listarPasarelas(bz.moneda.idMoneda).then(function(res){bz.pasarelas=res})}}).catch(function(){}).finally(function(){});if(bz.plan&&bz.plan.png.valor=="1"){bz.formatoSeleccionado=bz.formatos[0]}else if(bz.plan&&(bz.plan.editable.valor=="1"||bz.plan.png.valor=="0"&&bz.plan.editable.valor=="0")){bz.formatoSeleccionado=bz.formatosNoSociales[0]}}).catch(function(){});bz.comprobarMonedas=function(plan){var coincidencia=false;angular.forEach(plan.precios,function(valor){if(valor.moneda==bz.moneda.simbolo){coincidencia=true}});return coincidencia};bz.precioSeleccionado=function(precios){var precioFinal="";angular.forEach(precios,function(valor){if(valor.moneda==bz.moneda.simbolo){precioFinal=valor.moneda+" "+valor.precio}});return precioFinal};bz.seleccionar=function(formato){bz.formatoSeleccionado=angular.copy(formato)};bz.paypal=function(idPaypal,plan){if(bz.peticion){return}var datos={idLogo:bz.logo.id,idPrecio:null,idPasarela:idPaypal};bz.peticion=true;angular.forEach(plan.precios,function(valor){if(valor.moneda==bz.moneda.simbolo){datos.idPrecio=valor.idPrecio}});planesService.aumentarPedidoPlan(datos).then(function(res){$window.location=res}).catch(function(){}).finally(function(){bz.peticion=false})};bz.mostrarStripe=function(idStripe,plan){var idPrecio;angular.forEach(plan.precios,function(valor){if(valor.moneda==bz.moneda.simbolo){idPrecio=valor.idPrecio}});bz.datosStripe={idStripe:idStripe,idPrecio:idPrecio,idLogo:bz.logo.id}};bz.completado=true;bz.descargar=function(nombre,ancho,plantilla){if(bz.completado){bz.completado=false;angular.element(document.querySelector(".full-overlay")).fadeIn(1e3);logosService.descargarLogo(bz.logo.id,ancho,$filter("uppercase")(nombre),nombre,plantilla).then(function(res){var cd=res.headers["content-disposition"];var regex=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var match=regex.exec(cd);var fileName=match[1]||"LogoPro.zip";fileName=fileName.replace(/\"/g,"");var contentType=res.headers["content-type"];var blob=new Blob([res.data],{type:contentType});if($window.navigator&&$window.navigator.msSaveOrOpenBlob){$window.navigator.msSaveOrOpenBlob(blob,fileName)}else{var a=$document[0].createElement("a");$document[0].body.appendChild(a);a.style="display:none";var url=$window.URL.createObjectURL(blob);a.href=url;a.download=fileName;a.target="_blank";a.click();$window.URL.revokeObjectURL(url);a.remove()}}).finally(function(){bz.completado=true;angular.element(document.querySelector(".overlay.full")).fadeOut(1e3)})}};bz.descargarTodo=function(){if(bz.completado){bz.completado=false;angular.element(document.querySelector(".full-overlay")).fadeIn(1e3);var formatos={};var formatosCopia=angular.copy(bz.formatos);formatosCopia.push(bz.formatosNoSociales[1]);angular.forEach(formatosCopia,function(formato){formatos[formato.nombre]=formato.ancho});logosService.descargarTodo(bz.logo.id,formatos).then(function(res){var cd=res.headers["content-disposition"];var regex=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;var match=regex.exec(cd);var fileName=match[1]||"LogoPro.zip";fileName=fileName.replace(/\"/g,"");var contentType=res.headers["content-type"];var blob=new Blob([res.data],{type:contentType});if($window.navigator&&$window.navigator.msSaveOrOpenBlob){$window.navigator.msSaveOrOpenBlob(blob,fileName)}else{var a=$document[0].createElement("a");$document[0].body.appendChild(a);a.style="display:none";var url=$window.URL.createObjectURL(blob);a.href=url;a.download=fileName;a.target="_blank";a.click();$window.URL.revokeObjectURL(url);a.remove()}}).finally(function(){bz.completado=true;angular.element(document.querySelector(".full-overlay")).fadeOut(1e3)})}};bz.manualMarca=function(id){bz.esperaManual=true;angular.element(document.querySelector(".full-overlay")).fadeIn(1e3);logosService.manualMarca(id).then(function(res){var a=$document[0].createElement("a");$document[0].body.appendChild(a);a.style="display:none";var url=res.url;a.href=url;a.download=res.nombreArchivo;a.target="_blank";a.click();a.remove()}).finally(function(){bz.esperaManual=false;angular.element(document.querySelector(".full-overlay")).fadeOut(1e3)})};$scope.$on("sesionExpiro",function(){$state.go("inicio")})}])},function(module,exports){angular.module("disenador-de-logos").controller("cuentaController",["$scope","$state","pedidosService","clientesService","$mdToast","paisesValue","verificarBase64Factory","clienteDatosFactory","$window",function($scope,$state,pedidosService,clientesService,$mdToast,paisesValue,verificarBase64Factory,clienteDatosFactory,$window){var bz=this;bz.formulario=1;bz.paises=paisesValue;bz.verificarBase64=verificarBase64Factory;bz.pedidos=[];bz.datos={};bz.datosEspejo={};clientesService.datos().then(function(res){bz.datos=res});pedidosService.listarPedidos().then(function(res){angular.forEach(res,function(valor){if(valor.estado!="EN ESPERA"){bz.pedidos.push(valor)}})});bz.editar=function(datos){bz.datosEspejo=angular.copy(datos);bz.formulario=2};bz.completado=true;bz.guardar=function(datos,valido){if(valido&&bz.completado){bz.completado=false;clientesService.modificar(datos.nombreCliente,datos.telefono,datos.pais).then(function(){bz.datos=angular.copy(datos);bz.formulario=1;$mdToast.show($mdToast.base({args:{mensaje:"¡Datos modificados!",clase:"success"}}))}).catch(function(){$mdToast.show($mdToast.base({args:{mensaje:"Un error ha ocurrido",clase:"danger"}}))}).finally(function(){bz.completado=true})}};bz.fotoCargaCompletada=true;bz.cargandoFoto=false;bz.cargarFoto=function(imagen){console.log(imagen);if(imagen){if(bz.fotoCargaCompletada){bz.cargandoFoto=true;clientesService.avatar(imagen).then(function(res){bz.cargandoFoto=false;$mdToast.show($mdToast.base({args:{mensaje:"¡Foto de Perfil Cargada!",clase:"success"}}));var user=clienteDatosFactory.obtener();user.foto=res;$window.localStorage.setItem("bzToken",angular.toJson(user));clienteDatosFactory.definir(user);bz.datos.foto=res}).catch(function(){bz.cargandoFoto=false;$mdToast.show($mdToast.base({args:{mensaje:"Error al cargar la foto",clase:"danger"}}))}).finally(function(){bz.fotoCargaCompletada=true})}}};bz.datosOlvido={tipo:"cliente"};bz.cambiarContrasena=function(datos,v){bz.peticion=true;if(!v){bz.peticion=false;return $mdToast.show($mdToast.base({args:{mensaje:"LLene los campos correctamente.",clase:"danger"}}))}clientesService.verificarCambiaContrasena(datos).then(function(res){bz.formulario=1;$mdToast.show($mdToast.base({args:{mensaje:"Contraseña Modificada.",clase:"success"}}));bz.datosOlvido={tipo:"cliente"}}).catch(function(){bz.peticion=false}).finally(function(){bz.peticion=false})};$scope.$on("sesionExpiro",function(){$state.go("inicio")})}])},function(module,exports){angular.module("disenador-de-logos",["ngMessages","ui.router","ngAnimate","ngAria","ngMaterial","base64","colorpicker","720kb.socialshare","ngFileUpload"]).config(function($stateProvider,$httpProvider,$urlRouterProvider,$locationProvider,$mdToastProvider){$locationProvider.html5Mode(true);$httpProvider.interceptors.push("AuthInterceptor");$mdToastProvider.addPreset("base",{options:function(){return{templateUrl:"toast-base.html",hideDelay:0,position:"top right",controller:["$scope","$mdToast","$timeout","args",function($scope,$mdToast,$timeout,args){if(args){$scope.mensaje=args.mensaje;$scope.clase=args.clase}var temporizador=$timeout(function(){$mdToast.hide()},3e3);$scope.closeToast=function(){$timeout.cancel(temporizador);$mdToast.hide()}}],clickOutsideToClose:true}}});$stateProvider.state({name:"inicio",url:"/?datos",templateUrl:"app/views/inicio.tpl",controller:"inicioController as inicio",resolve:{landingResolve:["LS","$stateParams",function(LS,$stateParams){if($stateParams.datos){return angular.fromJson(decodeURI($stateParams.datos))}var datosLanding=LS.obtener("comenzar");if(datosLanding){return{datos:{nombre:datosLanding.nombre,categoria:{icono:datosLanding.idCategoria,fuente:datosLanding.idFuente},tags:datosLanding.etiquetasParaBusqueda,etiquetasSeleccionadas:datosLanding.etiquetasSeleccionadas,preferencias:datosLanding.preferencias},palettesCopy:datosLanding.palettesCopy,iconos:datosLanding.iconos,fuentes:datosLanding.fuentes}}return false}]}}).state({name:"editor",url:"/editor/",templateUrl:"app/views/editor.tpl",controller:"editorController as editor",params:{status:null,datos:{logo:null,texto:null,fuentes:null,idLogoGuardado:null}},resolve:{historicoResolve:["$q","$stateParams","LS",function($q,$stateParams,LS){var defered=$q.defer();var promise=defered.promise;if($stateParams.status){LS.definir("editor",$stateParams.datos);defered.resolve($stateParams.datos)}else if(LS.obtener("editor")){defered.resolve(LS.obtener("editor"))}else{defered.reject({error:"FALLO_HISTORICO"})}return promise}]}}).state({name:"pago",url:"/pago/",templateUrl:"app/views/pago.tpl",controller:"pagoController as pago",params:{status:null,datos:{logo:null,idElemento:null,tipo:null,plan:{nombre:null,idPlan:null},precio:{moneda:{simbolo:null,idMoneda:null},monto:null,idPrecio:null}}},resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(!clientesService.autorizado()){return $q.reject("AUTH_REQUIRED")}}],historicoResolve:["$q","$stateParams",function($q,$stateParams){var defered=$q.defer();var promise=defered.promise;if($stateParams.status){defered.resolve($stateParams.datos)}else{defered.reject({error:"FALLO_HISTORICO"})}return promise}]}}).state({name:"pagoCompleto",url:"/pago/completo/:id/",templateUrl:"app/views/pagoCompleto.tpl",controller:"pagoCompletoController as pagoCompleto",resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(!clientesService.autorizado()){return $q.reject("AUTH_REQUIRED")}}]}}).state({name:"cuenta",url:"/cliente/cuenta/",templateUrl:"app/views/cuenta.tpl",controller:"cuentaController as cuenta",resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(!clientesService.autorizado()){return $q.reject("AUTH_REQUIRED")}}]}}).state({name:"logos",url:"/cliente/logos/",templateUrl:"app/views/logos.tpl",controller:"logosController as logos",resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(!clientesService.autorizado()){return $q.reject("AUTH_REQUIRED")}}]}}).state({name:"descargar",url:"/cliente/logos/descargar/{id:int}/",templateUrl:"app/views/descargar.tpl",controller:"descargarController as descargar",params:{id:null},resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(!clientesService.autorizado()){return $q.reject("AUTH_REQUIRED")}}],logoResolve:["$q","$stateParams","logosService",function($q,$stateParams,logosService){if($stateParams.id){var defered=$q.defer();var promise=defered.promise;logosService.obtenerPorId($stateParams.id).then(function(res){if(res.estado=="Descargable"){defered.resolve({logo:res.logo,id:$stateParams.id,idElemento:res.elementos_idElemento,tipo:res.tipoLogo})}else{defered.reject("INVALID_LOGO")}}).catch(function(){defered.reject("INVALID_LOGO")});return promise}else{return $q.reject("INVALID_LOGO")}}]}}).state({name:"login",url:"/ingreso/",templateUrl:"app/views/login.tpl",controller:"loginController as login",resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(clientesService.autorizado()){return $q.reject("LOGOUT_REQUIRED")}}]}}).state({name:"logosGaleria",url:"/logos-galeria/",templateUrl:"app/views/logosGaleria.tpl",controller:"logosGaleriaController as logosGaleria"}).state({name:"papeleria",url:"/cliente/logos/papeleria/:id/",templateUrl:"app/views/papeleria.tpl",controller:"papeleriaController as papeleriaCtrl",resolve:{logoResolve:["$q","$stateParams","logosService","arrayToJsonMetasFactory",function($q,$stateParams,logosService,arrayToJsonMetasFactory){if($stateParams.id){var defered=$q.defer();var promise=defered.promise;logosService.obtenerPorId($stateParams.id).then(function(res){if(res.estado=="Descargable"){defered.resolve({logo:res.logo,id:$stateParams.id,idElemento:res.elementos_idElemento,tipo:res.tipoLogo,atributos:arrayToJsonMetasFactory(res.atributos)})}else{defered.reject("INVALID_LOGO")}}).catch(function(){defered.reject("INVALID_LOGO")});return promise}else{return $q.reject("INVALID_LOGO")}}]}}).state({name:"papeleriaEditor",url:"/cliente/logos/papeleria/:id/crear",templateUrl:"app/views/papeleriaEditor.tpl",controller:"papeleriaEditorController as papeleriaEditor",params:{papeleria:null},resolve:{currentAuth:["$q","clientesService",function($q,clientesService){if(!clientesService.autorizado()){return $q.reject("AUTH_REQUIRED")}}],logoResolve:["$q","$stateParams","logosService","arrayToJsonMetasFactory",function($q,$stateParams,logosService,arrayToJsonMetasFactory){if($stateParams.id){var defered=$q.defer();var promise=defered.promise;logosService.obtenerPorId($stateParams.id).then(function(res){if(res.estado=="Descargable"){defered.resolve({logo:res.logo,id:$stateParams.id,idElemento:res.elementos_idElemento,tipo:res.tipoLogo,atributos:arrayToJsonMetasFactory(res.atributos)})}else{defered.reject("INVALID_LOGO")}}).catch(function(){defered.reject("INVALID_LOGO")});return promise}else{return $q.reject("INVALID_LOGO")}}],papeleriaResolve:["$q","$stateParams",function($q,$stateParams){var papeleria={};if($stateParams.papeleria&&$stateParams.papeleria.papeleria&&$stateParams.papeleria.modelo){papeleria=$stateParams.papeleria.papeleria;papeleria.modelo=$stateParams.papeleria.modelo;papeleria.fuentes=$stateParams.papeleria.fuentes;if($stateParams.papeleria.pieza){angular.forEach($stateParams.papeleria.pieza.caras,function(cara,indiceCara){papeleria.modelo.caras[indiceCara].hooks=cara.hooks;papeleria.modelo.caras[indiceCara].logos=cara.logos});if($stateParams.papeleria.pieza._id){papeleria.idPieza=$stateParams.papeleria.pieza._id}}return papeleria}else{return $q.reject("PAPELERIA_INVALID")}}]}});$urlRouterProvider.rule(function($injector,$location){var path=$location.url();if("/"===path[path.length-1]||path.indexOf("/?")>-1){return}if(path.indexOf("?")>-1){return path.replace("?","/?")}return path+"/"});$urlRouterProvider.otherwise("/404/")}).run(function($rootScope,$state,$timeout){$rootScope.$on("$viewContentLoaded",function(){$timeout(function(){angular.element(document.querySelector(".overlay.full")).fadeOut(500)},3e3)});$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams,error){});$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){if(error==="AUTH_REQUIRED"){switch(toState.name){case"editor":switch(fromState.name){default:$state.go("login")}break;case"pago":switch(fromState.name){default:$state.go("login")}break;case"pagoCompleto":switch(fromState.name){case"":$state.go("login");break;default:$state.go("login")}break;case"cuenta":switch(fromState.name){case"":$state.go("login");break;default:$state.go("login")}break;case"logos":switch(fromState.name){case"":$state.go("login");break;default:$state.go("login")}break;case"descargar":switch(fromState.name){case"":$state.go("login");break;default:$state.go("login")}break;default:$state.go("inicio")}}else if(error==="LOGOUT_REQUIRED"){$state.go("cuenta")}else if(error==="PAPELERIA_INVALID"){$state.go("papeleria",{id:toParams.id})}else if(error==="INVALID_LOGO"){switch(toState.name){default:$state.go("logos")}}else if(error.error==="FALLO_HISTORICO"){switch(toState.name){case"editor":$state.go("inicio");break;case"pago":$state.go("inicio");break;default:$state.go("inicio")}}console.log(error)})})}]);